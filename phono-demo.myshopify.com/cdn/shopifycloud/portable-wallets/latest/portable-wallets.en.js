import.meta;var jn=Object.defineProperty,Vn=Object.defineProperties,Gn=Object.getOwnPropertyDescriptors,ze=Object.getOwnPropertySymbols,Yn=Object.prototype.hasOwnProperty,Qn=Object.prototype.propertyIsEnumerable,Wt=(n,t)=>(t=Symbol[n])?t:Symbol.for("Symbol."+n),jt=(n,t,e)=>t in n?jn(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,f=(n,t)=>{for(var e in t||(t={}))Yn.call(t,e)&&jt(n,e,t[e]);if(ze)for(var e of ze(t))Qn.call(t,e)&&jt(n,e,t[e]);return n},A=(n,t)=>Vn(n,Gn(t)),c=(n,t,e)=>(jt(n,typeof t!="symbol"?t+"":t,e),e),Vt=(n,t,e)=>{if(!t.has(n))throw TypeError("Cannot "+e)},K=(n,t,e)=>(Vt(n,t,"read from private field"),e?e.call(n):t.get(n)),rt=(n,t,e)=>{if(t.has(n))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(n):t.set(n,e)},qe=(n,t,e,r)=>(Vt(n,t,"write to private field"),r?r.call(n,e):t.set(n,e),e),Et=(n,t,e)=>(Vt(n,t,"access private method"),e),O=function(n,t){this[0]=n,this[1]=t},at=(n,t,e)=>{var r=(o,s,l,u)=>{try{var d=e[o](s),h=(s=d.value)instanceof O,y=d.done;Promise.resolve(h?s[0]:s).then(p=>h?r(o==="return"?o:"next",s[1]?{done:p.done,value:p.value}:p,l,u):l({value:p,done:y})).catch(p=>r("throw",p,l,u))}catch(p){u(p)}},a=o=>i[o]=s=>new Promise((l,u)=>r(o,s,l,u)),i={};return e=e.apply(n,t),i[Wt("asyncIterator")]=()=>i,a("next"),a("throw"),a("return"),i},M=(n,t,e)=>(t=n[Wt("asyncIterator")])?t.call(n):(n=n[Wt("iterator")](),t={},e=(r,a)=>(a=n[r])&&(t[r]=i=>new Promise((o,s,l)=>(i=a.call(n,i),l=i.done,Promise.resolve(i.value).then(u=>o({value:u,done:l}),s)))),e("next"),e("return"),t);const Jn=":host{display:flex;align-items:center;justify-content:center}";class Xn extends HTMLElement{constructor(){var t,e;super(),c(this,"size"),c(this,"color"),this.size=(t=this.getAttribute("size"))!=null?t:"1.5rem",this.color=(e=this.getAttribute("color"))!=null?e:"gray",this.attachShadow({mode:"open"})}connectedCallback(){this.render();const t=document.createElement("style");t.textContent=Jn,this.shadowRoot.appendChild(t)}render(){const t=this.shadowRoot,e='\n      width="'.concat(this.size,'"\n      height="').concat(this.size,'"\n      xmlns="http://www.w3.org/2000/svg"\n      aria-hidden="true"\n    ');switch(this.getAttribute("name")){case"warning":t.innerHTML="\n          <svg ".concat(e,' viewBox="0 0 16 14" fill="').concat(this.color,'">\n            <path d="M5.925 2.344c1.146-1.889 3.002-1.893 4.149 0l4.994 8.235c1.146 1.889.288 3.421-1.916 3.421h-10.305c-2.204 0-3.063-1.529-1.916-3.421l4.994-8.235zm1.075 1.656v5h2v-5h-2zm0 6v2h2v-2h-2z"/>\n          </svg>\n        ');break;case"close":t.innerHTML="\n          <svg ".concat(e,' viewBox="0 0 20 20" fill="').concat(this.color,'">\n            <path d="M17.1 4.3l-1.4-1.4-5.7 5.7-5.7-5.7-1.4 1.4 5.7 5.7-5.7 5.7 1.4 1.4 5.7-5.7 5.7 5.7 1.4-1.4-5.7-5.7z"/>\n          </svg>\n        ');break;default:t.innerHTML="";break}}}const Zn="#overlay{position:fixed;width:100%;height:100%;background:#0006;top:0;left:0;z-index:2147483647;animation:modalPop .3s ease-out}#modal{position:fixed;top:1em;left:50%;width:100%;max-width:460px;transform:translate(-50%,-100%);background:#fff;color:#000;border:1px solid #d0d0d0;border-radius:4px;animation:modalSlideInFromTop .3s forwards}@keyframes modalPop{0%{opacity:0}to{opacity:1}}@keyframes modalSlideInFromTop{0%{transform:translate(-50%,-100%)}to{transform:translate(-50%)}}@keyframes modalSlideInFromBottom{0%{transform:translate(-50%,100%)}to{transform:translate(-50%)}}@media only screen and (max-width: 640px){#modal{top:auto;bottom:0;animation:modalSlideInFromBottom .3s forwards}}#modal header,#modal footer{padding:1em}#modal header{display:flex;margin-bottom:2em;text-align:center;border-bottom:1px solid #d0d0d0}#title{flex-grow:2;display:flex;justify-content:center;font-size:1.6rem;margin:0}#title svg-icon{margin-right:.25em}#content{text-align:left;padding:0 1em 1em;overflow:auto;max-height:84vh}#modal #content p{margin:0}#close-icon,#close-button{cursor:pointer}#close-icon{min-width:24px;background:transparent;padding:0;border:none}#close-button{width:100%;padding:1em;color:#fff;background-color:#1773b0;border:none;border-radius:4px}#close-button:hover,#close-button:active{background:#136f99}#close-button:active,#close-button:focus{box-shadow:0 0 0 4px #1990c640}";var an=/^\s*at .*(\S+:\d+|\(native\))/m,tr=/^(eval@)?(\[native code])?$/;function er(n){return n.stack?n.stack.match(an)?nr(n):rr(n):[]}function on(n){if(n.indexOf(":")===-1)return[n];let t=/(.+?)(?::(\d+))?(?::(\d+))?$/.exec(n.replace(/[()]/g,""));return[t[1],t[2]?Number(t[2]):void 0,t[3]?Number(t[3]):void 0]}function nr(n){return n.stack.split("\n").filter(t=>!!t.match(an)).map(t=>{let e=t.replace(/^\s+/,"").replace(/^.*?\s+/,""),r=e.match(/ (\(.+\)$)/);e=r?e.replace(r[0],""):e;let a=on(r?r[1]:e),i=r&&e||void 0,o=["eval","<anonymous>"].indexOf(a[0])>-1?void 0:a[0];return{method:i,file:o,lineNumber:a[1],columnNumber:a[2]}})}function rr(n){return n.stack.split("\n").filter(t=>!t.match(tr)).map(t=>{if(t.indexOf("@")===-1&&t.indexOf(":")===-1)return{method:t};let e=/((.*".+"[^@]*)?[^@]*)(?:@)/,r=t.match(e),a=r&&r[1]?r[1]:void 0,i=on(t.replace(e,""));return{method:a,file:i[0],lineNumber:i[1],columnNumber:i[2]}})}var He="5",ar=class{constructor(n){c(this,"breadcrumbs",[]),c(this,"apiKey"),c(this,"plugins"),c(this,"appId"),c(this,"appType"),c(this,"appVersion"),c(this,"releaseStage"),c(this,"locale"),c(this,"userAgent"),c(this,"metadata"),c(this,"onError"),c(this,"onPostErrorListeners",[]);var t;this.apiKey=n.apiKey,this.appType=n.appType,this.appId=n.appId,this.appVersion=n.appVersion,this.releaseStage=n.releaseStage,this.locale=n.locale,this.userAgent=n.userAgent,this.metadata=n.metadata,this.onError=n.onError,this.plugins=(t=n.plugins)!=null?t:[],this.plugins.forEach(e=>e.load(this)),this.leaveBreadcrumb("Bugsnag started",void 0,"state")}leaveBreadcrumb(n,t,e="manual"){this.breadcrumbs.push({name:n,metaData:t,type:e,timestamp:new Date().toISOString()})}notify(n,{errorClass:t,severity:e,severityType:r,handled:a=!0,metadata:i,context:o}={}){var s,l;let u=f(f({},this.metadata),i),d=this.buildBugsnagEvent({error:n,errorClass:t,severityType:r,handled:a,severity:e,metadata:u,context:o});if(((l=(s=this.onError)==null?void 0:s.call(this,d))==null||l)&&this.releaseStage!=="development"){let h=this.sendToBugsnag(d);return this.onPostErrorListeners.forEach(y=>y(d)),h}return Promise.resolve()}addOnPostError(n){this.onPostErrorListeners.push(n)}buildBugsnagEvent({error:n,errorClass:t,severity:e="error",severityType:r="handledException",handled:a,metadata:i={},context:o}){let s=new Date().toISOString(),{breadcrumbs:l,appId:u,appType:d,appVersion:h,releaseStage:y,locale:p,userAgent:v}=this;return{payloadVersion:He,exceptions:[{errorClass:t!=null?t:n.name,stacktrace:or(u,n),message:n.message}],severity:e,severityReason:{type:r},unhandled:!a,app:{id:u,type:d,version:h,releaseStage:y},device:{time:s,locale:p,userAgent:v},breadcrumbs:l,context:o,metaData:i}}async sendToBugsnag(n){let{apiKey:t}=this,e={apiKey:t,notifier:{name:"Bugsnag JavaScript",version:"7.22.2",url:"https://github.com/bugsnag/bugsnag-js"},events:[n]};try{await fetch("https://notify.bugsnag.com/",{method:"POST",headers:{"Content-Type":"application/json","Bugsnag-Api-Key":t,"Bugsnag-Payload-Version":He,"Bugsnag-Sent-At":n.device.time},body:JSON.stringify(e)})}catch(r){console.warn("[bugsnag-light] failed to send an event"),console.warn(r)}}};function or(n,t){return er(t).map(e=>{var r,a,i,o;let s=(r=e.file)==null?void 0:r.includes(n);return{method:(a=e.method)!=null?a:"",file:(i=e.file)!=null?i:"",lineNumber:(o=e.lineNumber)!=null?o:0,columnNumber:e.columnNumber,inProject:s}})}function ir(n){let t=window.onerror;window.onerror=(e,r,a,i,o)=>{o&&n.notify(o,{severityType:"unhandledException",handled:!1}),typeof t=="function"&&t.apply(window.onerror,[e,r,a,i,o])}}function sr(n){window.addEventListener("unhandledrejection",({reason:t})=>{t&&n.notify(t,{severityType:"unhandledPromiseRejection",handled:!1})})}function wt(n){try{const t=new RegExp("(^| )".concat(n,"=([^;]+)")).exec(document.cookie);if(t){const e=t[2];try{return decodeURIComponent(e)}catch(r){return e}}return null}catch(t){return null}}const Jt={BRANDED_BUTTON:"shopify-payment-button__button shopify-payment-button__button--branded",UNBRANDED_BUTTON:"shopify-payment-button__button shopify-payment-button__button--unbranded",MORE_PAYMENT_OPTION_BUTTON:"shopify-payment-button__more-options",HIDDEN:"shopify-payment-button__button--hidden"},lr="wallet-cart-button",cr={DARK:"apple-pay--dark",LIGHT:"apple-pay--light"},ur="_shopify_y",sn=6,dr="discount_code",me="https://static-na.payments-amazon.com/checkout.js",hr={CURRENCY_CHANGE:"wallet_currency_change"},Xt="{{ICON}}",pr=["Load failed","Failed to fetch","when attempting to fetch resource"],mr=["Chrome-Lighthouse"],Zt={};function yr(n){return!n.exceptions[0]||(fr(n),gr())?!1:br(n)}function gr(){const n=navigator.userAgent;return mr.some(t=>n.includes(t))}function fr(n){var t,e;n.context=window.location.pathname,n.request||(n.request={}),n.request.url=window.location.href,n.device.orientation=(e=(t=window.screen)==null?void 0:t.orientation)==null?void 0:e.type,n.metaData=f(f({},Zt),n.metaData)}function br(n){var t,e,r;const a=n.exceptions[0];return pr.some(i=>{var o,s;return(s=(o=a.message)==null?void 0:o.includes(i))!=null?s:!1})||a.errorClass==="SilencedError"||a.stacktrace.some(i=>{var o;return(o=i.file)==null?void 0:o.includes("spin.dev")})||a.errorClass==="OpenTelemetryClientError"&&((t=a.message)!=null&&t.match(/Server responded with ([45]\d\d|undefined)/)||(e=a.message)!=null&&e.includes("error found in #10 byte"))||(r=a.message)!=null&&r.includes("GraphQL mutation failed with status 404")?!1:a.stacktrace.some(i=>!!(i!=null&&i.inProject))}var rn;const wr={apiKey:"cb577dc231be1c7494db8a63441ef66b",appId:"portable-wallets",appVersion:"0.0.0-b6ba663476bf83c68558df026f0bbc334cbb6ffa",releaseStage:"production",locale:"en",userAgent:navigator.userAgent,metadata:{user:{id:(rn=wt(ur))!=null?rn:"unknown"}},onError:yr},g=new ar(wr);function ye(n){for(const[t,e]of Object.entries(n))Zt[t]=f(f({},Zt[t]),e)}var ln={en:{instruments_copy:{checkout:{buy_now:"Buy it now"}},error_dialogs:{checkout:{title:"Transaction failed",generic_error:"Checkout is currently unavailable due to technical problems. Please try again in a few minutes.",button_text:"Return to store"},product:{out_of_stock:"This item is no longer available."},wallet:{title:"%{wallet} unavailable",generic_error:"There was an issue with %{wallet}. Try again or use a different payment method.",buy_with_prime:{empty_line_items:{title:"Buy with Prime no longer available",content:"Items that were eligible for Buy with Prime are no longer in your cart."}}}},more_payment_options:"More payment options",subscriptions:{buyer_consent:"One or more of the items in your cart is a recurring or deferred purchase. By continuing, I agree to the %{subscriptionPolicyLink} and authorize you to charge my payment method at the prices, frequency and dates listed on this page until my order is fulfilled or I cancel, if permitted.",cancellation_policy:"cancellation policy",subscription_policy:"Subscription policy",policy_not_found:"The subscription policy could not be found. Refresh the page or contact us for more information."},shipping_methods:{connect_shipping_methods:"%{methodOne} and %{methodTwo}"},order_summary:{total:"Total",subtotal:"Subtotal",duties:"Duties",taxes:"Taxes",shipping:"Shipping",shipping_one_time_purchase:"Shipping (One-time purchase)",shipping_subscription:"Shipping (Subscription)",discount:"Discount",subscriptions:{recurring_total_tooltip_line:"Does not include shipping, tax, duties, or any applicable discounts",recurring_totals:"%{fixedPrice} every %{interval}",recurring_totals_with_policies:{one:"First payment %{fixedPrice}, then %{recurringPrice} every %{interval}",other:"First %{count} payments %{fixedPrice} each, then %{recurringPrice} every %{interval}"},recurring_total_intervals:{day:{one:"day",other:"%{count} days"},month:{one:"month",other:"%{count} months"},week:{one:"week",other:"%{count} weeks"},year:{one:"year",other:"%{count} years"}}}},brand:{amazon_pay:"Amazon Pay",apple_pay:"Apple Pay",buy_with_prime:"Buy with Prime",paypal:"PayPal",google_pay:"Google Pay",shop_pay:"Shop Pay"},buy_with_button_content:"Buy with {{ICON}}",errors:{missing:{email:"Enter an email address",first_name:"Enter a first name",last_name:"Enter a last name",address1:"Enter an address",address2:"Enter an apartment, suite, etc.",city:"Enter a city",zone:"Select a state / province",phone:"Enter a phone number",postal_code:"Enter a ZIP / postal code"},invalid:{email:"Enter a valid email",first_name:"Enter a valid first name",last_name:"Enter a valid last name",address1:"Enter a valid address",address2:"Enter a valid apartment, suite, etc.",city:"Enter a valid city",zone:"Select a valid state / province",country:"Select a country / region",phone:"Enter a valid phone number",postal_code:"Enter a valid zip / postal code"}}}};ln.en;function $t(){return new te(ln)}class Ke extends Error{constructor(t,e){const r="i18n: Missing or invalid translation '".concat(t,"' in '").concat(e,"'");super(r)}}class Cr extends Error{constructor(t,e,r){const a="i18n: Missing translation template key '".concat(t,"' for '").concat(e,"' in '").concat(r,"'");super(a)}}class vr extends Error{constructor(t,e,r){const a="i18n: Invalid pluralization for '".concat(t,"':'").concat(e,"' in '").concat(r,"'");super(a)}}var At,q,Nt,cn,Rt,un,xt,dn;const Ee=class Ai{constructor(t){rt(this,Nt),rt(this,Rt),rt(this,xt),rt(this,At,void 0),rt(this,q,Ai.getDefaultLanguage()),qe(this,At,t)}static getDefaultLanguage(){return"en"}get locale(){return K(this,q)}translate(t,e={}){var r;const a=t.split(".");let i=K(this,At)[K(this,q)];try{for(const o of a)switch(typeof i){case"object":i=i[o];break;case"string":case"undefined":throw new Ke(t,K(this,q))}if(Et(this,Nt,cn).call(this,i,e)){if(typeof i=="string")throw new vr(t,i,K(this,q));i=i[Et(this,Rt,un).call(this,i,e.count)]}if(typeof i!="string")throw new Ke(t,K(this,q));return Et(this,xt,dn).call(this,i,e)}catch(o){return g.notify(o),(r=e.defaultValue)!=null?r:t}}};At=new WeakMap,q=new WeakMap,Nt=new WeakSet,cn=function(n,t){return typeof n!="string"&&t.count!=="undefined"},Rt=new WeakSet,un=function(n,t){let e=t===1?"one":"other";return t===0&&typeof n!="string"&&n.zero!=="undefined"&&(e="zero"),e},xt=new WeakSet,dn=function(n,t={}){const e=n.match(/%\{.+?\}/g);return e?e.reduce((r,a)=>{const i=a.replace(/%\{(.*)\}/,"$1");return t[i]?r.replace(a,t[i]):(g.notify(new Cr(i,n,K(this,q))),r)},n):n};let te=Ee;var k=(n=>(n.CartPage="cart_page",n.CartAjax="cart_ajax",n.ProductPage="product",n.Unknown="unknown",n))(k||{}),ft=(n=>(n.CartChange="/cart/change",n.CartUpdate="/cart/update",n.CartAdd="/cart/add",n.CartClear="/cart/clear",n))(ft||{}),vt=(n=>(n.OneTimePurchase="ONE_TIME_PURCHASE",n.Subscription="SUBSCRIPTION",n))(vt||{}),Sr=0;function ct(n){return"__private_"+Sr+++"_"+n}function E(n,t){if(!Object.prototype.hasOwnProperty.call(n,t))throw new TypeError("attempted to use private field on non-instance");return n}function ge(n){return Object.entries(n).map(([t,e])=>({key:t,value:{stringValue:String(e)}}))}const hn=1,Ar=Er(5,2,12);function Er(n,t,e){const r=[0];for(let a=0;a<e;a++){const i=Math.floor(n*t**a);r.push(i)}return r}var dt=ct("exporter"),U=ct("attributes"),L=ct("metrics");class _r{constructor({exporter:t,attributes:e}){Object.defineProperty(this,dt,{writable:!0,value:void 0}),Object.defineProperty(this,U,{writable:!0,value:void 0}),Object.defineProperty(this,L,{writable:!0,value:[]}),E(this,dt)[dt]=t,E(this,U)[U]=e!=null?e:{}}addAttributes(t){E(this,U)[U]=f(f({},E(this,U)[U]),t)}histogram({name:t,value:e,unit:r,bounds:a,attributes:i}){const o=Date.now()*1e6;E(this,L)[L].push({name:t,type:"histogram",value:e,unit:r,timeUnixNano:o,attributes:i,bounds:a})}counter({name:t,value:e,unit:r,attributes:a}){const i=Date.now()*1e6;E(this,L)[L].push({name:t,type:"counter",value:e,unit:r,timeUnixNano:i,attributes:a})}gauge({name:t,value:e,unit:r,attributes:a}){const i=Date.now()*1e6;E(this,L)[L].push({name:t,type:"gauge",value:e,unit:r,timeUnixNano:i,attributes:a})}async exportMetrics(){const t={};E(this,L)[L].forEach(r=>{switch(r.attributes=f(f({},E(this,U)[U]),r.attributes),r.type){case"histogram":Pr(t,r);break;case"counter":Ir(t,r);break;case"gauge":kr(t,r);break}});const e=Object.values(t);e.length!==0&&(E(this,L)[L]=[],await E(this,dt)[dt].exportMetrics(e))}}function Pr(n,t){var e;const{name:r,value:a,unit:i,timeUnixNano:o,attributes:s}=t,l=(e=t.bounds)!==null&&e!==void 0?e:Ar,u=new Array(l.length+1).fill(0);n[r]||(n[r]={name:r,unit:i||"1",histogram:{aggregationTemporality:hn,dataPoints:[]}});for(let d=0;d<u.length;d++){const h=l[d];if(h===void 0)u[d]=1;else if(a<=h){u[d]=1;break}}n[r].histogram.dataPoints.push({startTimeUnixNano:o,timeUnixNano:o,count:1,sum:a,min:a,max:a,bucketCounts:u,explicitBounds:l,attributes:ge(s!=null?s:{})})}function Ir(n,t){const{name:e,value:r,unit:a,timeUnixNano:i,attributes:o}=t;n[e]||(n[e]={name:e,unit:a||"1",sum:{aggregationTemporality:hn,isMonotonic:!0,dataPoints:[]}}),n[e].sum.dataPoints.push({startTimeUnixNano:i,timeUnixNano:i,asDouble:r,attributes:ge(o!=null?o:{})})}function kr(n,t){const{name:e,value:r,unit:a,timeUnixNano:i,attributes:o}=t;n[e]||(n[e]={name:e,unit:a||"1",gauge:{dataPoints:[]}}),n[e].gauge.dataPoints.push({startTimeUnixNano:i,timeUnixNano:i,asDouble:r,attributes:ge(o!=null?o:{})})}var ht=ct("url"),pt=ct("serviceName"),mt=ct("logger");class Tr{constructor(t,e,r){Object.defineProperty(this,ht,{writable:!0,value:void 0}),Object.defineProperty(this,pt,{writable:!0,value:void 0}),Object.defineProperty(this,mt,{writable:!0,value:void 0}),E(this,ht)[ht]=t,E(this,pt)[pt]=e,E(this,mt)[mt]=r==null?void 0:r.logger}async exportMetrics(t){var e;const r={resourceMetrics:[{resource:{attributes:[{key:"service.name",value:{stringValue:E(this,pt)[pt]}}]},scopeMetrics:[{scope:{name:"open-telemetry-mini-client",version:"0.3.3",attributes:[]},metrics:t}]}]},a=await fetch(E(this,ht)[ht],{method:"POST",keepalive:!0,headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if((e=E(this,mt)[mt])===null||e===void 0||e.log({status:a.status}),!a.ok){if(a.status===400){const i=await a.text();throw new Pt("Invalid OpenTelemetry Metrics: ".concat(i))}if(a.status===429||a.status===503){const i=await a.json(),o=a.headers.get("Retry-After"),s=o?{seconds:Number(o)}:void 0;throw new Pt("Server did not accept metrics",{errorData:i,retryAfter:s,metrics:t})}throw new Pt("Server responded with ".concat(a.status))}}}class Pt extends Error{constructor(t,e){super(t),this.metadata=void 0,this.name="OpenTelemetryClientError",this.metadata=e}}const Dr="https://otlp-http-production.shopifysvc.com/v1/metrics",Nr="portable_wallets";class Rr{constructor(t){this.exporter=t}async exportMetrics(t){var e;try{await this.exporter.exportMetrics(t)}catch(r){if(r instanceof Pt){const a=(e=r.metadata)==null?void 0:e.retryAfter;if(a){await new Promise(i=>{setTimeout(()=>{this.exportMetrics(t),i()},a.seconds*1e3)});return}}throw r}}}const xr=new Tr(Dr,Nr),Lr=new Rr(xr),P=new _r({exporter:Lr}),bt=[];function $(n,t,e){if(window.customElements==null)return;const r=t;window.customElements.get(n)||(window.customElements.define(n,r),e!=null&&e.isChildCustomElement&&bt.push(n))}function Or(){var n;const t=(n=window.Shopify)==null?void 0:n.CartType;let e=k.ProductPage;return window.Shopify?t===k.CartAjax?e=k.CartAjax:t===k.CartPage&&(e=k.CartPage):e=k.Unknown,e}function ee(n){return Number(n).toFixed(2)}function Bt(n){if(!(!n||!n.id||!n.id.includes("gid://shopify/Cart/")))return n.id.replace("gid://shopify/Cart/","").split("?")[0]}function Y(){let n;return[new Promise(t=>n=t),n]}const Fr={force_shop_pay_product:"direct_checkout_product",force_shop_pay_cart:"direct_checkout_cart"};function et(n,t="no_redirect_for_checkout"){P.exportMetrics();const e=new URL(n);switch(t){case"skip_shop_pay":e.searchParams.set("skip_shop_pay","true");break;case"no_redirect_for_checkout":e.searchParams.set("storefront_wallet","true");break;case"force_shop_pay_cart":case"force_shop_pay_product":case"force_shop_pay":{e.searchParams.set("payment","shop_pay");const r=Fr[t];r&&e.searchParams.set("redirect_source",r);break}}window.location.assign(e.toString())}function $r(){return!!document.querySelector('[data-source-attribution="shopify.shop-promise-pdp"]')}class Br extends HTMLElement{constructor(){super(),c(this,"overflow"),c(this,"formerFocus"),this.attachShadow({mode:"open"}),this.overflow="",this.formerFocus=document.activeElement}connectedCallback(){const t=$t();this.render(t);const e=this.shadowRoot,r=e.getElementById("modal");e.querySelectorAll("button").forEach(o=>o.addEventListener("click",this.closeModal.bind(this)));const a=e.getElementById("overlay");a==null||a.addEventListener("click",o=>this.handleOutsideClick(o,r)),document.addEventListener("keydown",this.handleEscapeKey.bind(this));const i=document.createElement("style");i.textContent=Zn,e.appendChild(i),this.overflow=document.body.style.overflow,document.body.style.overflow="hidden",this.trapFocus(r,e),$("svg-icon",Xn)}trapFocus(t,e){if(!t)return;const r=t.querySelectorAll("a[href], button"),a=Array.from(r),i=a[0],o=a[a.length-1];t.addEventListener("keydown",s=>{s.key==="Tab"&&!s.shiftKey&&e.activeElement===o&&(s.preventDefault(),i.focus()),s.key==="Tab"&&s.shiftKey&&e.activeElement===i&&(s.preventDefault(),o.focus())}),i.focus()}handleOutsideClick(t,e){e&&(e.contains(t.target)||this.closeModal())}handleEscapeKey(t){t.key==="Escape"&&this.closeModal()}closeModal(){var t;document.body.style.overflow=this.overflow,this.remove(),this.formerFocus&&"focus"in(this==null?void 0:this.formerFocus)&&typeof this.formerFocus.focus=="function"&&((t=this.formerFocus)==null||t.focus())}render(t){const e=this.getAttribute("title"),r=this.getAttribute("has-close-button"),a=t.translate("error_dialogs.checkout.button_text"),i='\n      <footer>\n        <button type="button" id="close-button" tabindex="0">'.concat(a,"</button>\n      </footer>\n    ");this.shadowRoot.innerHTML='\n      <div id="overlay">\n        <div id="modal" role="dialog" aria-modal="true" aria-labelledby="title">\n          <header>\n            <h2 id="title">\n              '.concat(e,'\n            </h2>\n            <button type="button" id="close-icon" aria-label=').concat(a,' tabindex="0">\n              <svg-icon name="close" color="gray"></svg-icon>\n            </button>\n          </header>\n          <div id="content">\n            <p><slot></slot></p>\n          </div>\n          ').concat(r?i:"","\n        </div>\n      </div>\n    ")}}function pn(n){n.setAttribute("tabindex","0")}function Mt(n="button"){const t=document.createElement("button");return pn(t),t.type=n,n!=="submit"&&(t.role="button"),t}function Mr(){const n=document.createElement("a");return pn(n),n}function j(n,t){for(const[e,r]of Object.entries(t))n.setAttribute(e,r)}function X(n,t){for(const[e,r]of Object.entries(t))n.style.setProperty(e,r)}function H(n,t){const e=document.createElement("top-level-modal");e.textContent=t,j(e,{"data-testid":"top-level-modal","has-close-button":"true",title:'<svg-icon name="warning" color="red"></svg-icon> '.concat(n)}),document.body.appendChild(e)}function Ur(n,t){const e=document.createElement("top-level-modal");e.innerHTML=t,j(e,{"data-testid":"top-level-modal",title:n}),document.body.appendChild(e)}function Ut(n){H(n.translate("error_dialogs.checkout.title"),n.translate("error_dialogs.product.out_of_stock"))}$("top-level-modal",Br);class mn extends HTMLElement{get buyerCountry(){return this.getAttribute("buyer-country")}get recommendedInstrument(){return this.getAttribute("recommended-instrument")}get buyerCurrency(){const t=this.getAttribute("buyer-currency");if(t==null)throw new Error("WalletElement buyer-currency is null");return t}get accessToken(){return this.getAttribute("access-token")}get disabled(){const t=this.getAttribute("disabled");return t==="true"||t===""}set disabled(t){t?this.setAttribute("disabled","true"):this.removeAttribute("disabled")}get hasSellingPlan(){const t=this.getAttribute("has-selling-plan");return t==="true"||t===""}set hasSellingPlan(t){t?this.setAttribute("has-selling-plan",""):this.removeAttribute("has-selling-plan")}get isShippingRequired(){const t=this.getAttribute("requires-shipping");return t==="true"||t===""}set isShippingRequired(t){t?this.setAttribute("requires-shipping",""):this.removeAttribute("requires-shipping")}}const zr=70;class Ct{constructor(t,e,r,a){c(this,"red"),c(this,"green"),c(this,"blue"),c(this,"opacity"),this.red=t||0,this.green=e||0,this.blue=r||0,this.opacity=typeof a>"u"?1:a}getLuminance(){const t=this.red&255,e=this.green&255,r=this.blue&255;return t*.2126+e*.7152+r*.0722}isDark(){return this.opacity===0?!1:this.getLuminance()/this.opacity<zr}blendWith(t,e){this.opacity=1-(1-t.opacity)*(1-e.opacity),this.red=this.blend(t.red,e.red,t,e),this.green=this.blend(t.green,e.green,t,e),this.blue=this.blend(t.blue,e.blue,t,e)}blend(t,e,r,a){return Math.round(t*r.opacity/this.opacity+e*a.opacity*(1-r.opacity)/this.opacity)}}function qr(n){const t=[...n];let e=new Ct(0,0,0,0),r=new Ct(255,255,255,1),a=t.shift();for(;a;)e.opacity>0&&a.opacity>0?(r=new Ct(0,0,0,0),r.blendWith(a,e)):a.opacity>0?r=a:r=e,e=r,a=t.shift();return r}const ne=new Ct(255,255,255,1);function Hr(n){const t=[];let e=n;for(;e.parentElement;){e=e.parentElement;const r=window.getComputedStyle(e).backgroundColor,a=Kr(r);if(r&&t.push(a),a.opacity===1)break}try{return qr(t.reverse())}catch(r){return g.notify(new Error("[BackgroundDetection] Failed to blend colors for element ".concat(n.outerHTML))),ne}}function Kr(n){if(!n)return ne;try{const t=n.split("(")[1].split(")")[0].replace(" ","").split(",");return new Ct(Number(t[0]),Number(t[1]),Number(t[2]),typeof t[3]>"u"?1:Number(t[3]))}catch(t){g.notify(new Error("[BackgroundDetection] Failed to convert rgbString to array ".concat(n)))}return ne}const Wr="https://monorail-edge.shopifysvc.com",jr="/v1/produce";function Vr(){if(typeof crypto<"u"&&crypto&&typeof crypto.randomUUID=="function")return crypto.randomUUID();const n=new Array(36);for(let t=0;t<36;t++)n[t]=Math.floor(Math.random()*16);return n[14]=4,n[19]=n[19]&=-5,n[19]=n[19]|=8,n[8]=n[13]=n[18]=n[23]="-",n.map(t=>t.toString(16)).join("")}function Gr(n){const t={"Content-Type":"application/json; charset=utf-8","X-Monorail-Edge-Event-Created-At-Ms":(n&&n.eventCreatedAtMs||Date.now()).toString(),"X-Monorail-Edge-Event-Sent-At-Ms":Date.now().toString(),"X-Monorail-Edge-Client-Message-Id":(n&&n.clientMessageId||Vr()).toString()};return n&&n.userAgent&&(t["User-Agent"]=n.userAgent),n&&n.remoteIp&&(t["X-Forwarded-For"]=n.remoteIp),t}async function Yr({endpoint:n,event:t,keepalive:e}){return fetch(n!=null?n:Wr+jr,{method:"post",headers:Gr(t.metadata),body:JSON.stringify({schema_id:t.schemaId,payload:t.payload}),keepalive:e})}var x=(n=>(n.Decelerated="portable_wallets_decelerated",n.InitCompleted="portable_wallets_init_completed",n.InstrumentLoadTime="portable_wallets_instrument_load_time",n.InstrumentLoadNotEligible="portable_wallets_instrument_load_not_eligible",n.MonorailProduceError="portable_wallets_monorail_produce_error",n.SheetClicked="portable_wallets_sheet_clicked",n.SheetCancelled="portable_wallets_sheet_cancelled",n.SheetFailed="portable_wallets_sheet_failed",n.AuthorizationAttempt="portable_wallets_authorization_attempt",n.AuthorizationComplete="portable_wallets_authorization_complete",n.CartTokenMissing="portable_wallets_cart_token_missing",n.GooglePayNotEligibleWebview="portable_wallets_google_pay_not_eligible_webview",n))(x||{}),Z=(n=>(n.InstrumentSdkLoaded="portable_wallets_instrument_sdk_loaded",n.InstrumentSdkFailed="portable_wallets_instrument_sdk_failed",n.InstrumentSdkEligible="portable_wallets_instrument_sdk_eligible",n.InstrumentSdkNotEligible="portable_wallets_instrument_sdk_not_eligible",n))(Z||{});const Qr=["Chrome-Lighthouse"];function Jr(){const n=navigator.userAgent;return Qr.some(t=>n.includes(t))}async function Xr(n){if(Jr())return;g.leaveBreadcrumb("monorail event produced to ".concat(n.schemaId),n);let t;try{t=await Yr({event:n})}catch(e){}t!=null&&t.ok||P.counter({name:x.MonorailProduceError,value:1,attributes:{schemaId:n.schemaId}})}const We="shopify_wallet_checkout_track/6.2";async function R(n){var t,e,r,a,i,o,s,l,u,d,h,y;(e=(t=window==null?void 0:window.ShopifyAnalytics)==null?void 0:t.lib)!=null&&e.trekkie||await new Promise($e=>{const Wn=setInterval(()=>{var vi,Ci;(Ci=(vi=window==null?void 0:window.ShopifyAnalytics)==null?void 0:vi.lib)!=null&&Ci.trekkie&&(clearInterval(Wn),$e())},100),Ni=setTimeout(()=>{clearInterval(Wn),clearTimeout(Ni),$e()},7e3)});const p=(i=(a=(r=window.ShopifyAnalytics)==null?void 0:r.lib)==null?void 0:a.trekkie)==null?void 0:i.defaultAttributes,v={uniqToken:(o=p==null?void 0:p.uniqToken)!=null?o:"",visitToken:(s=p==null?void 0:p.visitToken)!=null?s:"",microSessionId:(l=p==null?void 0:p.microSessionId)!=null?l:"",microSessionCount:(u=p==null?void 0:p.microSessionCount)!=null?u:0,shopId:(d=p==null?void 0:p.shopId)!=null?d:0,themeId:p==null?void 0:p.themeId,themeCityHash:(h=p==null?void 0:p.themeCityHash)!=null?h:"",contentLanguage:(y=p==null?void 0:p.contentLanguage)!=null?y:"",referer:p==null?void 0:p.referer},{uniqToken:C,visitToken:_,microSessionId:B,microSessionCount:Ne,shopId:Oe,themeId:Fe,themeCityHash:S,contentLanguage:_e,referer:ke}=v,{event:Pe,eventSubtype:Ie,checkoutToken:De,instrumentId:Pi,ttl:Ii,errorReason:ki}=n,Ue={schemaId:We,payload:{event:Pe,event_subtype:Ie,checkout_token:De,app_name:"storefront",page_type:Or(),instrument_id:Pi,ttl:Ii,uniq_token:C,visit_token:_,micro_session_id:B,micro_session_count:Ne,shop_id:Oe,theme_id:Fe,theme_city_hash:S,content_language:_e,referer:ke,checkout_one:!0,error_reason:ki}};if(!Pe){g.notify(new Error("Event is required"),{metadata:{request:{monorail:{schemaId:We,payload:JSON.stringify(Ue)}}}});return}await Xr(Ue)}var w=(n=>(n.BuyItNow="BuyItNow",n.MoreOptions="MoreOptions",n.ApplePay="ApplePay",n.PayPal="PayPal",n.Venmo="Venmo",n.GooglePay="GooglePay",n.ShopPay="ShopPay",n.MetaPay="FacebookPay",n.BuyWithPrime="BuyWithPrime",n.AmazonPay="AmazonPay",n))(w||{}),T=(n=>(n.CartInitCalled="portable_wallets_cart_init_called",n.ClickSheetCancelled="portable_wallets_instrument_click_sheet_cancelled",n.ClickSheetFailed="portable_wallets_instrument_click_sheet_failure",n.ClickSheetSuccess="portable_wallets_instrument_click_sheet_success",n.SheetFailed="portable_wallets_instrument_sheet_failed",n.AuthorizationAttempt="portable_wallets_authorization_attempt",n.AuthorizationComplete="portable_wallets_authorization_complete",n.InitCalled="portable_wallets_init_called",n.InitFailed="portable_wallets_init_failed",n.InitSuccess="portable_wallets_init_success",n.UpdateFailed="portable_wallets_instrument_update_failed",n.InstrumentLoaded="portable_wallets_instrument_loaded",n.InstrumentLoadFailed="portable_wallets_instrument_load_failed",n))(T||{});function Zr({apiClientId:n,cart:t}){var e;(e=window.Shopify)!=null&&e.analytics&&window.Shopify.analytics.publish("bwp_cart_widget_click",ta(t),{sendTo:n})}function ta(n){return n?{lineItems:n.lineItems.map(({quantity:t,totalAmount:e})=>({quantity:t,totalAmount:e})),totalAmount:n.totalAmount}:{}}function ea(){R({event:T.InitCalled})}function na({result:n,eventType:t}){var e,r;P.counter({name:x.InitCompleted,value:1,attributes:{result:n,eventType:t,recoveredFailure:!!((r=(e=window.Shopify)==null?void 0:e.PaymentButton)!=null&&r.failedToLoad)}}),R({event:n==="success"?T.InitSuccess:T.InitFailed,eventSubtype:t})}function ra({instrument:n,result:t,measurement:e}){e!=null&&P.histogram({name:x.InstrumentLoadTime,value:e,attributes:{instrument:n},unit:"ms"}),R({event:t==="success"?T.InstrumentLoaded:T.InstrumentLoadFailed,instrumentId:n,ttl:e})}function aa({instrument:n,measurement:t,result:e}){t!=null&&P.histogram({name:Z.InstrumentSdkLoaded,value:t,attributes:{instrument:n,result:e},unit:"ms"});const r=e==="success"?Z.InstrumentSdkLoaded:Z.InstrumentSdkFailed;R({event:r,instrumentId:n,ttl:t,errorReason:e==="success"?void 0:e})}function oa({instrument:n,result:t,reason:e}){P.counter({name:Z.InstrumentSdkEligible,value:1,attributes:{instrument:n,reason:e,result:t}});const r=t==="success"?Z.InstrumentSdkEligible:Z.InstrumentSdkNotEligible;R({event:r,instrumentId:n})}function ia({instrument:n,reason:t}){P.counter({name:x.InstrumentLoadNotEligible,value:1,attributes:{instrument:n,reason:t}})}function sa({instrument:n,result:t,checkoutToken:e,webPixelMetaData:r}){P.counter({name:x.SheetClicked,value:1,attributes:{instrument:n,result:t}}),R({event:t==="success"?T.ClickSheetSuccess:T.ClickSheetFailed,checkoutToken:e,instrumentId:n}),n===w.BuyWithPrime&&r&&Zr(r)}function la(n,t){R({event:"".concat(T.UpdateFailed,"-").concat(t),instrumentId:n})}function ca(n){P.counter({name:x.SheetCancelled,value:1,attributes:{instrument:n}}),R({event:T.ClickSheetCancelled,instrumentId:n})}function ua(n,t){P.counter({name:x.SheetFailed,value:1,attributes:{instrument:n}}),R({event:T.SheetFailed,instrumentId:n,errorReason:t==null?void 0:t.message})}function da(n){P.counter({name:x.AuthorizationAttempt,value:1,attributes:{instrument:n}}),R({event:T.AuthorizationAttempt,instrumentId:n})}function ha({instrument:n,measurement:t,result:e}){t!=null&&P.histogram({name:x.AuthorizationComplete,value:t,attributes:{instrument:n,result:e},unit:"ms"}),R({event:T.AuthorizationComplete,eventSubtype:e,ttl:t,instrumentId:n})}function pa({instrument:n,reason:t}){P.counter({name:x.Decelerated,value:1,attributes:{instrument:n,reason:t}}),P.exportMetrics()}function ma({reason:n}){P.counter({name:x.CartTokenMissing,value:1,attributes:{reason:n}})}function ya(){window.setInterval(()=>{P.exportMetrics()},1e3)}const m={initStarted:I(ea),initCompleted:I(na),instrumentLoaded:I(ra),instrumentLoadNotEligible:I(ia),instrumentSDKLoaded:I(aa),instrumentSDKEligible:I(oa),sheetClicked:I(sa),sheetCancelled:I(ca),sheetFailed:I(ua),updateFailed:I(la),authorizationAttempt:I(da),authorizationComplete:I(ha),startExporter:I(ya),decelerated:I(pa),cartTokenMissing:I(ma)};function I(n){return(...t)=>{try{n(...t)}catch(e){g.notify(e)}}}var N=(n=>(n.ButtonDisplay="buttonDisplay",n.LoadInstrument="loadInstrument",n.LoadSdk="loadSDK",n.AuthorizationLatency="authorizationLatency",n))(N||{});function yn(){var n,t;return!!((n=window.performance)!=null&&n.mark)&&!!((t=window.performance)!=null&&t.measure)}function zt(n,t){return qt(n,t),()=>tt(n,t)}function qt(n,t){yn()&&window.performance.mark("".concat(n,"-").concat(t,"-start"))}function tt(n,t){var e,r;if(yn())try{const a="".concat(n,"-").concat(t,"-start"),i="".concat(n,"-").concat(t,"-end"),o="".concat(n,"-").concat(t,"-duration");window.performance.mark(i);const s=(r=window.performance.measure(o,a,i))!=null?r:(e=window.performance.getEntriesByName(o,"measure"))==null?void 0:e[0],l=s==null?void 0:s.duration;if(l==null){g.notify(new Error("Could not measure performance of ".concat(n," ").concat(t)),{severity:"warning"});return}return l}catch(a){g.notify(a);return}}class V extends mn{constructor(){super(),c(this,"i18n"),c(this,"dataSource"),c(this,"apiClient"),c(this,"classNames"),c(this,"containerInstanceNumber"),c(this,"onRendered"),c(this,"setI18n"),c(this,"setDataSource"),c(this,"setApiClient"),c(this,"setClassNames"),c(this,"setContainerInstanceNumber"),c(this,"parsedWalletParams"),this.onRendered=()=>{},[this.i18n,this.setI18n]=Y(),[this.dataSource,this.setDataSource]=Y(),[this.apiClient,this.setApiClient]=Y(),[this.classNames,this.setClassNames]=Y(),[this.containerInstanceNumber,this.setContainerInstanceNumber]=Y()}async cleanupOnFailure(t,e){var r;try{await t()}catch(a){g.notify(a);const i=await this.containerInstanceNumber;m.instrumentLoaded({instrument:e,result:"failed",measurement:tt(N.ButtonDisplay,"".concat(e,":").concat(i))}),(r=this.parentElement)==null||r.remove()}}attributeChangedCallback(t,e,r,a){e!==r&&t==="disabled"&&a&&(r?(a.setAttribute("aria-disabled","true"),a.setAttribute("disabled","true")):(a.removeAttribute("aria-disabled"),a.removeAttribute("disabled")))}get pageType(){return this.getAttribute("page-type")}get buttonTheme(){return Hr(this).isDark()?"LIGHT":"DARK"}get walletParams(){var t;if(this.parsedWalletParams===void 0)try{this.parsedWalletParams=JSON.parse((t=this.getAttribute("wallet-params"))!=null?t:"{}")}catch(e){throw new Error("Error while parsing wallet-params JSON: ".concat(e))}return this.parsedWalletParams}}const ga="#more-payment-options-link{cursor:pointer}";var b=(n=>(n.InvalidLanguage="Variable $language of type LanguageCode was provided invalid value",n.InvalidCountry="Variable $country of type CountryCode was provided invalid value",n.MissingCartId="Variable $cartId of type ID! was provided invalid value",n.BuyerIdentityInvalidCountry="Variable $buyerIdentity of type CartBuyerIdentityInput! was provided invalid value for countryCode",n.BuyerIdentityInvalidPhone="INVALID: buyerIdentity.phone",n.BuyerIdentityEmailRequired="BUYER_IDENTITY_EMAIL_REQUIRED",n.DeliveryFirstNameInvalid="DELIVERY_FIRST_NAME_INVALID",n.DeliveryFirstNameRequired="DELIVERY_FIRST_NAME_REQUIRED",n.DeliveryLastNameInvalid="DELIVERY_LAST_NAME_INVALID",n.DeliveryLastNameRequired="DELIVERY_LAST_NAME_REQUIRED",n.DeliveryAddress1Required="DELIVERY_ADDRESS1_REQUIRED",n.DeliveryAddress1Invalid="DELIVERY_ADDRESS1_INVALID",n.DeliveryAddress2Required="DELIVERY_ADDRESS2_REQUIRED",n.DeliveryAddress2Invalid="DELIVERY_ADDRESS2_INVALID",n.DeliveryCityRequired="DELIVERY_CITY_REQUIRED",n.DeliveryCityInvalid="DELIVERY_CITY_INVALID",n.DeliveryZoneNotFound="DELIVERY_ZONE_NOT_FOUND",n.DeliveryZoneRequiredForCountry="DELIVERY_ZONE_REQUIRED_FOR_COUNTRY",n.DeliveryPostalCodeInvalid="DELIVERY_POSTAL_CODE_INVALID",n.DeliveryInvalidPostalCodeForZone="DELIVERY_INVALID_POSTAL_CODE_FOR_ZONE",n.DeliveryInvalidPostalCodeForCountry="DELIVERY_INVALID_POSTAL_CODE_FOR_COUNTRY",n.DeliveryPostalCodeRequired="DELIVERY_POSTAL_CODE_REQUIRED",n.DeliveryCountryInvalid="INVALID: buyerIdentity.deliveryAddressPreferences.0.deliveryAddress.country",n.DeliveryPhoneNumberRequired="DELIVERY_PHONE_NUMBER_REQUIRED",n.DeliveryPhoneNumberInvalid="DELIVERY_PHONE_NUMBER_INVALID",n.MerchandiseOutOfStock="MERCHANDISE_OUT_OF_STOCK",n.InvalidQuantity="INVALID: input.lines.0.quantity",n.UnacceptablePaymentsAmount="PAYMENTS_UNACCEPTABLE_PAYMENT_AMOUNT",n.DeliveryNotAvailable="DELIVERY_NO_DELIVERY_AVAILABLE",n.PendingDeliveryGroups="PENDING_DELIVERY_GROUPS",n.InvalidPaymentAmount="INVALID_PAYMENT: payment.amount",n))(b||{});function fa(n){const t=e=>{e.persisted&&(n(),window.removeEventListener("pageshow",t))};window.addEventListener("pageshow",t)}class ba extends Error{constructor(t){super("[".concat(t.name,"] ").concat(t.message)),this.stack=t.stack,this.name="HandleCreateCartError"}}async function nt({element:n,instrumentName:t,dataSource:e,willHandleErrorCodes:r,walletPreferences:a}){try{const i=await e.getCart({walletPreferences:a}),{cart:o,errors:s}=i;if(fa(()=>{n&&(n.disabled=!1)}),!o||!o.id)throw new Error("[".concat(t,"] received invalid cart"));if(!o.checkoutUrl)throw new Error("[".concat(t,"] Created cart with no checkout URL"));if(s.length>0&&!(r!=null&&r(s)))throw new Error("Failed to create cart: ".concat(JSON.stringify(s)));const l=s.length===1&&s[0]===b.InvalidQuantity&&o.lineItems.every(u=>u.quantity===0);return A(f({},i),{outOfStock:l})}catch(i){throw new ba(i)}finally{n.disabled=!1}}class wa extends V{constructor(){super(...arguments),c(this,"anchor")}static get observedAttributes(){return["disabled"]}connectedCallback(){this.render()}attributeChangedCallback(t,e,r){super.attributeChangedCallback(t,e,r,this.anchor)}async handleClick(t){if(t.preventDefault(),this.disabled||!this.anchor||this.anchor.getAttribute("disabled"))return;this.disabled=!0;const[e,r]=await Promise.all([this.i18n,this.dataSource]);try{const{outOfStock:a,cart:i}=await nt({element:this,instrumentName:w.MoreOptions,dataSource:r,willHandleErrorCodes(s){return s.length===1&&s[0]===b.InvalidQuantity}});if(a){Ut(e);return}const o=this.recommendedInstrument===w.ShopPay?"skip_shop_pay":"allow_redirect";et(i.checkoutUrl,o)}catch(a){g.notify(a),H(e.translate("error_dialogs.checkout.title"),e.translate("error_dialogs.checkout.generic_error"))}}async render(){const t=await this.i18n,e=await this.classNames;this.anchor=Mr(),this.anchor.textContent=t.translate("more_payment_options"),this.anchor.className=e,this.anchor.setAttribute("id","more-payment-options-link"),this.disabled&&this.anchor.setAttribute("disabled","true"),this.anchor.onclick=a=>this.handleClick(a),this.appendChild(this.anchor);const r=document.createElement("style");r.textContent=ga,this.appendChild(r)}}class gn extends HTMLElement{constructor(){super(),c(this,"i18n"),c(this,"apiClient"),c(this,"setI18n"),c(this,"setApiClient"),[this.i18n,this.setI18n]=Y(),[this.apiClient,this.setApiClient]=Y()}}const Ca="#buyer-consent{margin-top:1em}#buyer-consent-button{background:none;border:none;padding:0;text-decoration:underline;font-size:inherit;cursor:pointer}#buyer-consent-button:before{box-shadow:none}";class fn extends gn{connectedCallback(){this.innerHTML="",this.render()}async render(){const t=await this.i18n,e=await this.apiClient,r=document.createElement("p");r.setAttribute("id","buyer-consent");const a=document.createElement("buyer-consent-button");a.setI18n(t),a.setApiClient(e),r.innerHTML=t.translate("subscriptions.buyer_consent",{subscriptionPolicyLink:'<span id="subscription-policy-button"></span>'}),r.querySelector("#subscription-policy-button").appendChild(a);const i=document.createElement("style");i.textContent=Ca;const o=new DocumentFragment;o.appendChild(i),o.appendChild(r),this.appendChild(o)}}class va extends gn{constructor(){super(...arguments),c(this,"isFetchingPolicy",!1),c(this,"policy")}connectedCallback(){this.render()}async render(){const t=await this.i18n,e=Mt();e.setAttribute("id","buyer-consent-button"),e.textContent=t.translate("subscriptions.cancellation_policy"),e.onclick=this.onClick.bind(this),this.appendChild(e)}async onClick(t){t.preventDefault();const e=await this.i18n,r=await this.apiClient;if(!this.isFetchingPolicy){if(this.policy){this.showPolicy(this.policy,e);return}try{await this.fetchSubscriptionPolicy(r);const a=this.policy&&this.policy!==""?this.policy:e.translate("subscriptions.policy_not_found");this.showPolicy(a,e)}catch(a){g.notify(a),this.showPolicy(e.translate("subscriptions.policy_not_found"),e)}}}async fetchSubscriptionPolicy(t){this.isFetchingPolicy=!0,this.policy=await t.fetchSubscriptionPolicy(),this.isFetchingPolicy=!1}showPolicy(t,e){Ur(e.translate("subscriptions.subscription_policy"),t)}}$("buyer-consent-button",va,{isChildCustomElement:!0}),$("buyer-consent",fn);class Sa extends Error{constructor({code:t,message:e}){super(e),c(this,"name","DeveloperError"),c(this,"code","unknown"),this.code=t}}class Aa extends Error{constructor({message:t}){super(t),c(this,"name","SilencedError")}}class Ea extends Error{constructor(){super(...arguments),c(this,"name","MissingConfigError")}}function fe(n,t,e){if(bt!=null&&bt.length){const r=bt.join(",");n.querySelectorAll(r).forEach(a=>{e===null?a.removeAttribute(t):a.setAttribute(t,e)})}}function _a(n,t){try{const e=JSON.parse(n!=null?n:"[]");if(!(e instanceof Array))throw new Error("[".concat(t,"] invalid walletConfigs found"));return e}catch(e){throw new Error("[".concat(t,"] Error while parsing walletConfigs JSON: ").concat(e))}}function Pa(n,t){try{return n?JSON.parse(n):null}catch(e){throw new Error("[".concat(t,"] Error while parsing walletConfig JSON: ").concat(e))}}function be(n){var t;const e=n==null?void 0:n.getLoadEligibility();return e!=null&&e.eligible||m.instrumentLoadNotEligible({instrument:n==null?void 0:n.getInstrumentName(),reason:e==null?void 0:e.reason}),(t=e==null?void 0:e.eligible)!=null?t:!1}function Ia(n){return n.filter(be)}async function re({walletInstrument:n,instanceNumber:t}){const e=n.getInstrumentName(),r=zt(N.LoadSdk,"".concat(e,":").concat(t));try{await n.loadWalletSDK(),m.instrumentSDKLoaded({instrument:e,measurement:r(),result:"success"})}catch(i){return g.notify(i),m.instrumentSDKLoaded({instrument:e,measurement:r(),result:"failed"}),null}const a=n.getPartnerSDKEligibility();return a.eligible?(m.instrumentSDKEligible({instrument:e,result:"success"}),n):(m.instrumentSDKEligible({instrument:e,reason:a.reason,result:"failed"}),null)}class we extends mn{constructor(){super(...arguments),c(this,"apiClient"),c(this,"i18n")}get shopId(){return this.getAttribute("shop-id")}get cartId(){return this.getAttribute("cart-id")}get walletConfigs(){return this.getAttribute("wallet-configs")}get recommendedWallet(){return this.getAttribute("recommended")}get fallbackWallet(){return this.getAttribute("fallback")}get variantParams(){var t;try{return JSON.parse((t=this.getAttribute("variant-params"))!=null?t:"[]")}catch(e){throw new Sa({code:"invalid-variant-params",message:"variant-params must be a valid JSON string"})}}triggerLoadedEvent(){document.dispatchEvent(new Event("shopify:payment_button:loaded",{bubbles:!0,cancelable:!0}))}async attributeChangedCallback(t,e,r){e!==r&&fe(this,t,r)}toggleBuyerConsent(t,e,r){if(this.hasSellingPlan){const i=document.createElement("buyer-consent");i.setI18n(r),i.setApiClient(e),t.appendChild(i);return}const a=document.querySelector("buyer-consent");a&&t.contains(a)&&a.remove()}}$("buyer-consent",fn,{isChildCustomElement:!0});const yt=Element.prototype;function bn(n){const t=Ce(n);return wn(t)}function wn(n){var t;const e=n==null?void 0:n.elements;if(!e)return null;const r=It(e,"id");if(!r||isNaN(Number(r)))return null;const a=Number((t=It(e,"quantity"))!=null?t:"1"),i="gid://shopify/ProductVariant/".concat(r),o=It(e,"selling_plan"),s=o?"gid://shopify/SellingPlan/".concat(o):void 0,l=Ta(n);return{variantId:r,quantity:a,merchandiseId:i,sellingPlanId:s,lineItemProperties:l}}function Ce(n){const t=je(n,"[data-shopify='payment-button']")||document.querySelector("[data-shopify='payment-button']");return je(t,"form")}function ka(n){const t=n==null?void 0:n.elements;return t?!!It(t,"selling_plan"):!1}function Ta(n){if(!n)return{};const t=document.querySelectorAll('[name^="properties"][form^="'.concat(CSS.escape(n.getAttribute("id")||""),'"]')),e=n.querySelectorAll('[name^="properties"]'),r=[...t,...e],a={};return r.forEach(i=>{const o=Da(i),s=Na(i);o&&typeof s<"u"&&(a[o]=s)}),a}function Da(n){const t=n.getAttribute("name");if(t===null)return null;const e=t.indexOf("["),r=t.lastIndexOf("]");return e===-1||r===-1?null:t.substring(e+1,r)}function Na(n){if(!(["radio","checkbox"].includes(n.type)&&!n.checked)&&!(n.value===""||typeof n.value>"u"))return n.value}function It(n,t){var e;const r=n.namedItem(t);return r&&"value"in r&&(e=r.value)!=null?e:null}function je(n,t){if(yt.matches=yt.matches||yt.webkitMatchesSelector||yt.msMatchesSelector||yt.mozMatchesSelector,!n||n.matches(t))return n;let e=n;for(;e&&e!==document.body;)if(e=e.parentElement,e&&e.matches(t))return e;return null}class Ra{constructor(t,e){c(this,"addToCartMutationObserver"),c(this,"addToCartForm"),c(this,"addToCartButtons"),this.element=t,this.onFormChanged=e,this.addToCartMutationObserver=null,this.addToCartForm=null,this.addToCartButtons=[]}setupMutationObservers(){if(this.findAndSetAddToCartButtons(),!this.addToCartForm)return;this.syncComponentStateWithForm();const t=new MutationObserver(()=>this.reobserveOnFormChanges());this.addToCartMutationObserver=new MutationObserver(()=>this.syncComponentStateWithForm()),t.observe(this.addToCartForm,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),this.observeAddToCartButtons()}syncComponentStateWithForm(){if(!this.addToCartForm){this.onFormChanged({disabled:!0,hasSellingPlan:!1});return}const t=wn(this.addToCartForm),e=!!(this.addToCartButtons.length>0&&this.addToCartButtons.every(r=>r.disabled));this.onFormChanged({disabled:e||t===null,hasSellingPlan:ka(this.addToCartForm)})}observeAddToCartButtons(){this.addToCartButtons.forEach(t=>{this.addToCartMutationObserver.observe(t,{attributes:!0})})}reobserveOnFormChanges(){var t;(t=this.addToCartMutationObserver)==null||t.disconnect(),this.findAndSetAddToCartButtons(),this.observeAddToCartButtons(),this.syncComponentStateWithForm()}findAndSetAddToCartButtons(){this.addToCartForm=Ce(this.element),this.addToCartForm&&(this.addToCartButtons=[...this.addToCartForm.querySelectorAll("[type=submit]")])}}function xa(n,t,e){try{const r=JSON.parse(n!=null?n:"{}"),a=JSON.parse(t!=null?t:JSON.stringify({name:"buy_it_now",wallet_params:{}}));if(r===null||Object.keys(r).length===0){if(!(a instanceof Object))throw new Error("[".concat(e,"] Invalid fallback wallet configs JSON"));return{recommendedWallet:null,fallbackWallet:a}}return{recommendedWallet:r,fallbackWallet:a}}catch(r){throw new Error("[".concat(e,"] Error while parsing recommended/fallback JSON: ").concat(r))}}class La extends V{constructor(){super(...arguments),c(this,"name",w.BuyItNow),c(this,"button",null)}static get observedAttributes(){return["disabled"]}connectedCallback(){this.cleanupOnFailure(this.render.bind(this),this.name)}attributeChangedCallback(t,e,r){super.attributeChangedCallback(t,e,r,this.button)}async handleClick(){if(this.disabled||!this.button||this.button.getAttribute("aria-disabled"))return;this.disabled=!0;const[t,e]=await Promise.all([this.i18n,this.dataSource]);try{const{outOfStock:r,cart:a}=await nt({element:this,instrumentName:this.name,dataSource:e,willHandleErrorCodes(i){return i.length===1&&i[0]===b.InvalidQuantity}});if(m.sheetClicked({instrument:this.name,checkoutToken:Bt(a),result:"success"}),r){Ut(t);return}et(a.checkoutUrl,"allow_redirect")}catch(r){g.notify(r),m.sheetClicked({instrument:this.name,result:"failed"}),H(t.translate("error_dialogs.checkout.title"),t.translate("error_dialogs.checkout.generic_error"))}}async render(){var t;this.button||(this.button=Mt());const e=await this.classNames;this.button.textContent=(await this.i18n).translate("instruments_copy.checkout.buy_now"),this.button.className=e,this.disabled&&this.button.setAttribute("aria-disabled","true"),this.button.onclick=()=>this.handleClick(),this.appendChild(this.button),(t=this.onRendered)==null||t.call(this)}}function Oa(){const n=navigator.userAgent,t=n.indexOf("Android")>-1,e=n.indexOf("Chrome/")>-1,r=parseInt((/Chrome\/([0-9]+)/.exec(n)||["0","0"])[1],10);return t&&e&&r===114}class G{constructor(t){c(this,"walletParams"),this.walletParams=t.wallet_params}static walletName(){throw new Error("Must define walletName for WalletInstrument subclass")}createWebComponent({walletContainer:t,dataSource:e,i18n:r,apiClient:a,containerInstanceNumber:i,classNames:o="",callToAction:s,pageType:l=k.ProductPage,onRendered:u=()=>{}}){var d,h,y;const p=this.getWebComponentName();$(p,this.getWebComponentClass(),{isChildCustomElement:!0});const v=document.createElement(p),C={"access-token":(d=t.accessToken)!=null?d:"","buyer-country":(h=t.buyerCountry)!=null?h:"","buyer-currency":t.buyerCurrency,disabled:String(t.disabled),"wallet-params":JSON.stringify((y=this.walletParams)!=null?y:{}),"page-type":l};try{j(v,C),t.isShippingRequired&&v.setAttribute("requires-shipping",""),t.hasSellingPlan&&v.setAttribute("has-selling-plan","")}catch(_){const B=_;throw B.message.includes("setAttribute is not a function")&&Oa()?new Aa({message:B.message}):B}return s&&v.setAttribute("call-to-action",""),v.setDataSource(e),v.setApiClient(a),v.setI18n(r),v.setClassNames(o),v.setContainerInstanceNumber(i),v.onRendered=u,v}loadWalletSDK(){return Promise.resolve()}getLoadEligibility(){return{eligible:!0}}getPartnerSDKEligibility(){return{eligible:!0}}}class Fa extends G{static walletName(){return"buy_it_now"}getWebComponentName(){return"shopify-buy-it-now-button"}getInstrumentName(){return w.BuyItNow}getWebComponentClass(){return La}}const $a="shopify-paypal-button[disabled=true]{opacity:.5;cursor:not-allowed;pointer-events:none}";async function kt(n){const{cartClient:t,instrumentName:e}=n;try{if(!n.cartId)throw new Error("[".concat(e,"] provided no cart ID when updating buyer identity"));if(!t)throw new Error("[".concat(e,"] provided invalid cart client when updating buyer identity"));return await t.updateCartBuyerIdentity(n)}catch(r){throw m.updateFailed(e,"updateBuyerIdentity"),r}}async function Cn({cartId:n,totalAmount:t,paymentMethod:e,billingAddress:r,cartClient:a,instrumentName:i,abortSignal:o,hasSellingPlan:s,canUsePaymentMethodForFreeOrder:l}){try{if(!n)throw new Error("[".concat(i,"] provided no cart ID when updating payment"));if(!t)throw new Error("[".concat(i,"] provided no total amount when updating payment"));if(!e)throw new Error("[".concat(i,"] provided no apple pay wallet content when updating payment"));if(!a)throw new Error("[".concat(i,"] provided invalid cart client when updating payment"));const u={freePaymentMethod:{billingAddress:r}};return await a.updateCartPayment(n,f({amount:{amount:t.amount,currencyCode:t.currencyCode}},Number(t.amount)<=0&&!l&&!s?u:e),o)}catch(u){throw m.updateFailed(i,"updatePayment"),u}}function vn({cart:n,buyerCurrency:t,instrumentName:e}){if(!n)return!1;const r=n.totalAmount.amount;if(!r||Number(r)===0||t.toUpperCase()===n.totalAmount.currencyCode.toUpperCase())return!1;const a=new URL(n.checkoutUrl);return a.searchParams.set(hr.CURRENCY_CHANGE,"true"),m.decelerated({instrument:e,reason:"currency_changed"}),et(a.toString()),!0}class Ba extends V{constructor(){super(),c(this,"name",w.PayPal),c(this,"abortController"),c(this,"cartId"),c(this,"sdkButtonsComponent"),c(this,"container",null),c(this,"measurementContainer",null),c(this,"resizeObserver",null),c(this,"buttonHeight"),c(this,"rendering",!1),this.abortController=typeof AbortController=="function"&&new AbortController||null,this.resizeObserver=typeof ResizeObserver=="function"&&new ResizeObserver(t=>this.onResize(t))||null}connectedCallback(){this.cleanupOnFailure(this.render.bind(this),this.name)}disconnectedCallback(){this.sdkButtonsComponent&&this.sdkButtonsComponent.close(),this.resizeObserver&&this.resizeObserver.disconnect()}async onResize(t){var e,r,a;this.measurementContainer&&this.getPayPalConstrainedHeight((r=(e=t[0])==null?void 0:e.contentRect)==null?void 0:r.height)!==this.buttonHeight&&!this.rendering&&(await((a=this.sdkButtonsComponent)==null?void 0:a.close()),this.container.innerHTML="",this.sdkButtonsComponent=void 0,await this.cleanupOnFailure(this.renderFromPayPalSDK.bind(this),this.name))}async render(){var t;const e=document.createElement("style");e.innerHTML=$a;const r=document.createElement("div"),a=document.createElement("div"),i=await this.classNames;r.className=i,a.className=i,j(r,{role:"button"}),j(a,{role:"button","aria-hidden":"true",tabindex:"-1"}),a.innerHTML="&nbsp;",X(r,{display:"flex",overflow:"hidden","max-height":"55px"}),X(a,{display:"block",opacity:"0",visibility:"hidden","pointer-events":"none",position:"absolute","max-height":"55px"}),this.appendChild(a),this.appendChild(e),this.appendChild(r),this.container=r,this.measurementContainer=a,this.renderFromPayPalSDK(),(t=this.resizeObserver)==null||t.observe(this.measurementContainer)}async renderFromPayPalSDK(){var t,e,r;if(!this.container)throw new Error("button container not set when attempting to render");this.rendering=!0;const a=this.walletParams.paymentIntent==="TOKENIZE",i=()=>this.createToken(this.apiClient);let o,s;a?s=i:o=i;const l=async(h,y)=>{if(this.disabled)return y.reject();try{const[p,v]=await Promise.all([this.dataSource,this.i18n]),{outOfStock:C,cart:_}=await nt({element:this,instrumentName:this.name,dataSource:p,willHandleErrorCodes(B){return B.length===1&&B[0]===b.InvalidQuantity}});return C?(Ut(v),y.reject()):(this.cartId=_.id,y.resolve())}catch(p){return p instanceof Error&&(m.sheetClicked({instrument:this.name,result:"failed"}),g.notify(p),H(u.translate("error_dialogs.checkout.title"),u.translate("error_dialogs.checkout.generic_error"))),y.reject()}},u=await this.i18n,d=this.getPayPalConstrainedHeight(this.getContainerHeight());this.sdkButtonsComponent=(e=(t=window.paypal).Buttons)==null?void 0:e.call(t,{fundingSource:"paypal",style:{color:"gold",label:this.hasAttribute("call-to-action")?"pay":"paypal",height:d,shape:"sharp"},createOrder:o,createBillingAgreement:s,onApprove:async h=>{await this.onApprove(h)},onCancel:()=>{var h;m.sheetCancelled(this.name),(h=this.abortController)==null||h.abort()},onClick:l,onError:h=>{var y;if(h.message==="Window is closed, can not determine type"){m.sheetCancelled(this.name),(y=this.abortController)==null||y.abort();return}g.notify(h);const p=u.translate("brand.paypal");H(u.translate("error_dialogs.wallet.title",{wallet:p}),u.translate("error_dialogs.wallet.generic_error",{wallet:p}))}}),await((r=this.sdkButtonsComponent)==null?void 0:r.render(this.container)),this.rendering=!1,this.onRendered()}async createToken(t){const e=await t;try{if(!this.cartId)throw new Error("cartId not found when creating token");const r=await e.paypalTokenCreate(this.cartId);return m.sheetClicked({instrument:this.name,result:"success"}),r}catch(r){throw m.sheetClicked({instrument:this.name,result:"failed"}),r}}async onApprove({orderID:t,payerID:e}){var r,a,i;try{if(m.authorizationAttempt(this.name),qt(N.AuthorizationLatency,this.name),!this.cartId)throw new Error("Cart not found");const o=await this.apiClient,s=await o.paypalBuyerDetailsFetch(t,this.cartId),{data:l}=await kt({cartId:this.cartId,cartClient:o,instrumentName:this.name,emailAddress:s.email,streetAddress:s.destinationAddress});if(!l)throw new Error("Cart not found");if(await Cn({abortSignal:(r=this.abortController)==null?void 0:r.signal,cartClient:o,cartId:l.id,instrumentName:w.PayPal,billingAddress:(a=s.billingAddress)!=null?a:s.destinationAddress,paymentMethod:{walletPaymentMethod:{paypalWalletContent:{billingAddress:(i=s.billingAddress)!=null?i:s.destinationAddress,email:s.email,expiresAt:s.expiresAt,payerId:e,token:t,acceptedSubscriptionTerms:!1,vaultingAgreement:!1}}},canUsePaymentMethodForFreeOrder:!0,totalAmount:l.totalAmount}),vn({cart:l,buyerCurrency:this.buyerCurrency,instrumentName:this.name}))return;m.authorizationComplete({instrument:this.name,result:"success",measurement:tt(N.AuthorizationLatency,this.name)}),et(l.checkoutUrl)}catch(o){throw m.authorizationComplete({instrument:this.name,result:"failure",measurement:tt(N.AuthorizationLatency,this.name)}),o}}getPayPalConstrainedHeight(t){if(t)return Math.min(55,Math.max(t,25))}getContainerHeight(){if(!this.measurementContainer)return this.buttonHeight;const t=this.measurementContainer.getBoundingClientRect().height;return this.buttonHeight=t,t}}const Q=class xe extends G{static walletName(){return"paypal"}constructor(t){super(t)}getWebComponentName(){return"shopify-paypal-button"}getInstrumentName(){return w.PayPal}getWebComponentClass(){return Ba}loadWalletSDK(){if(xe.paypalSDKPromise)return xe.paypalSDKPromise;const t=document.createElement("script");return t.setAttribute("src",this.walletParams.sdkUrl),xe.paypalSDKPromise=new Promise((e,r)=>{t.onload=()=>e(),t.onerror=a=>{document.body.removeChild(t),r(a)},document.body.appendChild(t)}),xe.paypalSDKPromise}getLoadEligibility(){return{eligible:!0}}getPartnerSDKEligibility(){var t,e;return(e=(t=window==null?void 0:window.paypal)==null?void 0:t.Buttons)!=null&&e.call(t).isEligible()?{eligible:!0}:{eligible:!1,reason:"failed PayPal SDK eligibility check"}}};c(Q,"paypalSDKPromise");let ae=Q;const Ma=".apple-pay-button{display:flex;align-items:center;justify-content:center;width:100%;padding:0!important;cursor:pointer;border:none}.apple-pay-button:hover:not(:disabled){filter:brightness(92%)}.apple-pay-button svg{height:100%;flex-shrink:0}.apple-pay--content{width:100%;height:100%;flex-grow:1;display:flex;align-items:center;justify-content:center;white-space:pre}.apple-pay--light{background:#fff;color:#000}.apple-pay--light svg{fill:#000}.apple-pay--dark{background:#000;color:#fff}.apple-pay--dark svg{fill:#fff}",oe={UK:"GB",JA:"JP"},Sn=["AS","GU","MP","PR","VI"];Sn.forEach(n=>{oe[n]="US"});function _t(n){var t,e;const r=n.countryCode,a={firstName:n.givenName||void 0,lastName:n.familyName||void 0,address1:(t=n==null?void 0:n.addressLines)==null?void 0:t[0],address2:((e=n==null?void 0:n.addressLines)==null?void 0:e[1])||void 0,city:n.locality||void 0,zip:n.postalCode||void 0,province:n.administrativeArea||n.subLocality||void 0,country:Ua(n.countryCode),phone:n.phoneNumber||void 0};return a.country==="HK"&&(a.zip=void 0,a.province=n.postalCode),r&&Sn.includes(r)&&(a.province=r),a.lastName||(a.lastName=a.firstName),a}function Ua(n){if(!n)return"ZZ";const t=n.toUpperCase();return Object.keys(oe).includes(t)?oe[t]:t}function za(n,t){return ot({label:n,possibleLines:[t]})[0]}function qa({subtotal:n,deliveryGroups:t,duties:e,taxes:r,discountAllocations:a,i18n:i,formattedRecurringTotals:o}){var s;const l=ot({label:i.translate("order_summary.subtotal"),possibleLines:[n]}),u=Ha(t,i),d=ot({label:i.translate("order_summary.duties"),possibleLines:[e]}),h=ot({label:i.translate("order_summary.taxes"),possibleLines:[r]}),y=o.map(C=>({label:C,amount:"0.00",type:"pending"})),p=y.length?[{label:i.translate("order_summary.subscriptions.recurring_total_tooltip_line"),amount:"0.00",type:"pending"}]:[],v=(s=a==null?void 0:a.flatMap(C=>{var _;const B=(_=C.title)!=null?_:C.code;return ot({label:B!=null?B:i.translate("order_summary.discount"),possibleLines:[C.discountedAmount],isDiscount:!0})}))!=null?s:[];return[...l,...u,...d,...h,...v,...y,...p]}function ot({label:n,possibleLines:t,isDiscount:e=!1}){return t.filter(r=>(r==null?void 0:r.amount)!==void 0).map(r=>({label:n,amount:e?"-".concat(ee(r.amount)):ee(r.amount)}))}function Ha(n,t){return n.some(e=>e.groupType===vt.Subscription)?n.map(e=>({label:e.groupType===vt.Subscription?t.translate("order_summary.shipping_subscription"):t.translate("order_summary.shipping_one_time_purchase"),amount:ee(e.selectedDeliveryOption.estimatedCost.amount)})):ot({label:t.translate("order_summary.shipping"),possibleLines:n.map(e=>{var r;return{amount:(r=e.selectedDeliveryOption)==null?void 0:r.estimatedCost.amount}})})}function Ka(n,t){return n.map(e=>{var r;return{title:Va(e,t),estimatedCost:{amount:ja(e),currencyCode:e[0].estimatedCost.currencyCode},handle:Ga(e),description:(r=e[0].description)!=null?r:""}})}function Wa(n){return n.map(t=>t.deliveryOptions.map(e=>A(f({},e),{groupType:t.groupType}))).reduce((t,e)=>t.flatMap(r=>e.map(a=>[...r,a])),[[]])}function ja(n){return n.reduce((t,e)=>t+Number(e.estimatedCost.amount),0).toFixed(2)}function Va(n,t){var e,r;const a=(e=n.find(s=>s.groupType===vt.OneTimePurchase))==null?void 0:e.title,i=(r=n.find(s=>s.groupType===vt.Subscription))==null?void 0:r.title,o=[...new Set([a,i])].filter(Boolean);return o.length===2?t.translate("shipping_methods.connect_shipping_methods",{methodOne:o[0],methodTwo:o[1]}):o[0]}function Ga(n){return n.map(t=>t.handle).join(",")}function Ya(n,t){if(!n.length)return[];const e=Wa(n);return Ka(e,t).map(r=>{var a;return{label:r.title||"",amount:r.estimatedCost.amount,identifier:r.handle,detail:(a=r.description)!=null?a:""}})}const Gt=async({paymentSheetAction:n,onProceed:t,terminateSession:e})=>{switch(n.action){case"abort":e();break;case"show_error":await t(n.errors);break;case"update":await t(n.errors);break;default:throw new Error('Missing handler for payment sheet action "'.concat(n.action,'"'))}},Qa=["abort","show_error","complete","update"];class Ja{constructor(){c(this,"generatePrioritizedPaymentSheetAction",(t,e)=>{let r;const a=[],i=[],o=[],s=e.filter(u=>u!==b.UnacceptablePaymentsAmount).some(u=>t[u]!==void 0);for(const u of Object.keys(t))if(!(u===b.UnacceptablePaymentsAmount&&s)){const d=t[u]();d.effects&&i.push(...d.effects),d.action!=="complete"&&d.errors&&o.push(...d.errors),a.push(d)}const l=(u=>Qa.map(d=>u.find(h=>h.action===d)).find(d=>!!d))(a);return l&&(r=l,r.effects=i,r.action!=="complete"&&(r.errors=o)),r})}getMergedPaymentSheetAction({result:t,errorActions:e}){const r={};e.forEach(i=>{i.errors.forEach(o=>{t.errors.includes(o)&&(r[o]=i.generateAction)})});let a;for(const i of t.errors){const o=r[i];if(o){a=o();break}}return{firstPaymentSheetAction:a,prioritizedPaymentSheetAction:this.generatePrioritizedPaymentSheetAction(r,t.errors)}}getUnhandledErrors(t,e){const r=e.flatMap(a=>a.errors);return t.filter(a=>!r.includes(a))}}class Xa extends Ja{constructor(t){super(),this.i18n=t}mapMutationResultToPaymentSheetAction(t,e){var r;const a=this.getErrorActions();if(this.getUnhandledErrors(t.errors,a).forEach(o=>{g.notify(new Error("[".concat(w.ApplePay,"] mutation result error not handled: ").concat(o)))}),((r=t.data)==null?void 0:r.deliveryGroups.length)===0&&e!=null&&e.shippingRequired)return{action:"show_error",errors:[new ApplePayError("addressUnserviceable")]};const{firstPaymentSheetAction:i}=this.getMergedPaymentSheetAction({result:t,errorActions:a});return i||{action:"update",errors:[]}}mapCompletionResultToPaymentSheetAction(t){if(!t.data)throw new Error("[".concat(w.ApplePay,"] completion returned null result"));switch(t.data.__typename){case"SubmitSuccess":return{action:"complete",redirectUrl:t.data.redirectUrl};case"SubmitAlreadyAccepted":case"SubmitThrottled":case"SubmitFailed":{const e=this.getErrorActions();this.getUnhandledErrors(t.errors,e).forEach(a=>{g.notify(new Error("[".concat(w.ApplePay,"] completion result error not handled: ").concat(a)))});const{prioritizedPaymentSheetAction:r}=this.getMergedPaymentSheetAction({result:t,errorActions:e});return r||{action:"abort"}}default:throw new Error("[".concat(w.ApplePay,"] unknown completion result type: ").concat(t.data.__typename))}}getErrorActions(){return[{errors:[b.InvalidLanguage],generateAction:()=>({action:"abort",effects:[()=>{g.notify(new Error("[".concat(w.ApplePay,"] mutation provided invalid language, aborting")))}]})},{errors:[b.InvalidCountry],generateAction:()=>({action:"abort",effects:[()=>{g.notify(new Error("[".concat(w.ApplePay,"] mutation provided invalid country, aborting")))}]})},{errors:[b.MissingCartId],generateAction:()=>({action:"abort",effects:[()=>{g.notify(new Error("[".concat(w.ApplePay,"] mutation provided invalid cart ID, aborting")))}]})},{errors:[b.UnacceptablePaymentsAmount],generateAction:()=>({action:"abort"})},{errors:[b.InvalidPaymentAmount],generateAction:()=>({action:"abort"})},{errors:[b.MerchandiseOutOfStock],generateAction:()=>({action:"abort"})},{errors:[b.DeliveryNotAvailable],generateAction:()=>({action:"show_error",errors:[new ApplePayError("addressUnserviceable")]})},{errors:[b.BuyerIdentityEmailRequired],generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","emailAddress",this.i18n.translate("errors.missing.email"))]})},{errors:[b.DeliveryFirstNameRequired],generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","name",this.i18n.translate("errors.missing.first_name"))]})},{errors:[b.DeliveryFirstNameInvalid],generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","name",this.i18n.translate("errors.invalid.first_name"))]})},{errors:[b.DeliveryLastNameRequired],generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","name",this.i18n.translate("errors.missing.last_name"))]})},{errors:[b.DeliveryLastNameInvalid],generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","name",this.i18n.translate("errors.invalid.last_name"))]})},{errors:[b.DeliveryAddress1Required],generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","addressLines",this.i18n.translate("errors.missing.address1"))]})},{errors:[b.DeliveryAddress1Invalid],generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","addressLines",this.i18n.translate("errors.invalid.address1"))]})},{errors:[b.DeliveryAddress2Required],generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","addressLines",this.i18n.translate("errors.missing.address2"))]})},{errors:[b.DeliveryAddress2Invalid],generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","addressLines",this.i18n.translate("errors.invalid.address2"))]})},{errors:[b.DeliveryCityRequired],generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","locality",this.i18n.translate("errors.missing.city"))]})},{errors:[b.DeliveryCityInvalid],generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","locality",this.i18n.translate("errors.invalid.city"))]})},{errors:[b.DeliveryZoneRequiredForCountry],generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","administrativeArea",this.i18n.translate("errors.missing.zone"))]})},{errors:[b.DeliveryZoneNotFound],generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","administrativeArea",this.i18n.translate("errors.invalid.zone"))]})},{errors:[b.DeliveryPostalCodeRequired],generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","postalCode",this.i18n.translate("errors.missing.postal_code"))]})},{errors:[b.DeliveryPostalCodeInvalid,b.DeliveryInvalidPostalCodeForZone,b.DeliveryInvalidPostalCodeForCountry],generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","postalCode",this.i18n.translate("errors.invalid.postal_code"))]})},{errors:[b.DeliveryPhoneNumberRequired],generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","phoneNumber",this.i18n.translate("errors.missing.phone"))]})},{errors:[b.DeliveryPhoneNumberInvalid,b.BuyerIdentityInvalidPhone],generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","phoneNumber",this.i18n.translate("errors.invalid.phone"))]})},{errors:[b.BuyerIdentityInvalidCountry,b.DeliveryCountryInvalid],generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","country",this.i18n.translate("errors.invalid.country"))]})}]}}const Ve=["name","postalAddress"];function Za({shippingRequired:n,walletParams:t,buyerCurrency:e}){const{phoneRequired:r,emailRequired:a}=t,i=[...a?["email"]:[],...r?["phone"]:[]],o=n?[...Ve,...i]:i;return{countryCode:t.countryCode,currencyCode:e,merchantCapabilities:t.merchantCapabilities,supportedNetworks:t.supportedNetworks,total:{type:"pending",label:t.merchantName,amount:"1.00"},requiredBillingContactFields:Ve,requiredShippingContactFields:o,shippingType:t.shippingType}}const to=n=>{const t=n.lineItems.reduce((e,r)=>e+Number(r.subtotalAmount.amount),0);return{amount:String(t),currencyCode:n.totalAmount.currencyCode}},eo=n=>{const t=n.lineItems.flatMap(e=>e.discountAllocations);return[...n.discountCodes.filter(e=>e.applicable&&n.discountAllocations.findIndex(r=>r.code===e.code)===-1&&t.findIndex(r=>r.code===e.code)===-1).map(e=>({code:e.code,discountedAmount:{amount:"0",currencyCode:n.totalAmount.currencyCode}})),...n.discountAllocations,...t]};function no(n,t){return n.reduce((e,r)=>{var a;if(!r.sellingPlanAllocation)return e;const{sellingPlanAllocation:{sellingPlan:i,priceAdjustments:o},quantity:s}=r;if(!i.recurringDeliveries||!i.billingPolicy)return e;const l=ro({billingPolicy:i.billingPolicy,i18n:t}),u=i.priceAdjustments[0].orderCount,d=o[0].price.currencyCode,h=Ge({price:Number(o[0].price.amount)*s,currencyCode:d,locale:t.locale});if(o.length===2){const y=o[1].price.currencyCode,p=Ge({price:Number((a=o[1])==null?void 0:a.price.amount)*s,currencyCode:y,locale:t.locale});return[...e,t.translate("order_summary.subscriptions.recurring_totals_with_policies",{count:u,fixedPrice:h,recurringPrice:p,interval:l})]}return[...e,t.translate("order_summary.subscriptions.recurring_totals",{fixedPrice:h,interval:l})]},[])}function Ge({price:n,currencyCode:t,locale:e}){return Intl.NumberFormat(e,{style:"currency",currency:t,currencyDisplay:"narrowSymbol"}).format(n)}function ro({billingPolicy:n,i18n:t}){const{interval:e,intervalCount:r}=n,a={YEAR:"order_summary.subscriptions.recurring_total_intervals.year",MONTH:"order_summary.subscriptions.recurring_total_intervals.month",WEEK:"order_summary.subscriptions.recurring_total_intervals.week",DAY:"order_summary.subscriptions.recurring_total_intervals.day"}[e];if(!a)throw new Error("Unknown selling plan interval provided: ".concat(e));return t.translate(a,{count:r})}const Ht="GraphQL Client",Ye=0,Qe=3,An="An error occurred while fetching from the API. Review 'graphQLErrors' for details.",En="Response returned unexpected Content-Type:",_n="An unknown error has occurred. The API did not return a data object or any errors in its response.",ie={json:"application/json",multipart:"multipart/mixed"},Je="X-SDK-Variant",Xe="X-SDK-Version",ao="shopify-graphql-client",oo="0.10.3",Pn=1e3,io=[429,503],In=/@(defer)\b/i,Ze="\r\n",so=/boundary="?([^=";]+)"?/i,tn=Ze+Ze;function W(n,t=Ht){return n.startsWith("".concat(t))?n:"".concat(t,": ").concat(n)}function ut(n){return n instanceof Error?n.message:JSON.stringify(n)}function kn(n){return n instanceof Error&&n.cause?n.cause:void 0}function Tn(n){return n.flatMap(({errors:t})=>t!=null?t:[])}function Dn({client:n,retries:t}){if(t!==void 0&&(typeof t!="number"||t<Ye||t>Qe))throw new Error("".concat(n,': The provided "retries" value (').concat(t,") is invalid - it cannot be less than ").concat(Ye," or greater than ").concat(Qe))}function D(n,t){return t&&(typeof t!="object"||Array.isArray(t)||typeof t=="object"&&Object.keys(t).length>0)?{[n]:t}:{}}function Nn(n,t){if(n.length===0)return t;const e={[n.pop()]:t};return n.length===0?e:Nn(n,e)}function Rn(n,t){return Object.keys(t||{}).reduce((e,r)=>(typeof t[r]=="object"||Array.isArray(t[r]))&&n[r]?(e[r]=Rn(n[r],t[r]),e):(e[r]=t[r],e),Array.isArray(n)?[...n]:f({},n))}function xn([n,...t]){return t.reduce(Rn,f({},n))}function lo({clientLogger:n,customFetchApi:t=fetch,client:e=Ht,defaultRetryWaitTime:r=Pn,retriableCodes:a=io}){const i=async(o,s,l)=>{const u=s+1,d=l+1;let h;try{if(h=await t(...o),n({type:"HTTP-Response",content:{requestParams:o,response:h}}),!h.ok&&a.includes(h.status)&&u<=d)throw new Error;return h}catch(y){if(u<=d){const p=h==null?void 0:h.headers.get("Retry-After");return await co(p?parseInt(p,10):r),n({type:"HTTP-Retry",content:{requestParams:o,lastResponse:h,retryAttempt:s,maxRetries:l}}),i(o,u,l)}throw new Error(W("".concat(l>0?"Attempted maximum number of ".concat(l," network retries. Last message - "):"").concat(ut(y)),e))}};return i}async function co(n){return new Promise(t=>setTimeout(t,n))}function uo({headers:n,url:t,customFetchApi:e=fetch,retries:r=0,logger:a}){Dn({client:Ht,retries:r});const i={headers:n,url:t,retries:r},o=ho(a),s=lo({customFetchApi:e,clientLogger:o,defaultRetryWaitTime:Pn}),l=po(s,i),u=mo(l),d=vo(l);return{config:i,fetch:l,request:u,requestStream:d}}function ho(n){return t=>{n&&n(t)}}async function Ln(n){const{errors:t,data:e,extensions:r}=await n.json();return f(f(f({},D("data",e)),D("extensions",r)),t||!e?{errors:A(f({networkStatusCode:n.status,message:W(t?An:_n)},D("graphQLErrors",t)),{response:n})}:{})}function po(n,{url:t,headers:e,retries:r}){return async(a,i={})=>{const{variables:o,headers:s,url:l,retries:u}=i,d=JSON.stringify({query:a,variables:o});Dn({client:Ht,retries:u});const h=Object.entries(f(f({},e),s)).reduce((p,[v,C])=>(p[v]=Array.isArray(C)?C.join(", "):C.toString(),p),{});!h[Je]&&!h[Xe]&&(h[Je]=ao,h[Xe]=oo);const y=[l!=null?l:t,{method:"POST",headers:h,body:d}];return n(y,1,u!=null?u:r)}}function mo(n){return async(...t)=>{if(In.test(t[0]))throw new Error(W("This operation will result in a streamable response - use requestStream() instead."));try{const e=await n(...t),{status:r,statusText:a}=e,i=e.headers.get("content-type")||"";return e.ok?i.includes(ie.json)?Ln(e):{errors:{networkStatusCode:r,message:W("".concat(En," ").concat(i)),response:e}}:{errors:{networkStatusCode:r,message:W(a),response:e}}}catch(e){return{errors:{message:ut(e)}}}}}function yo(n){return at(this,null,function*(){const t=new TextDecoder;if(n.body[Symbol.asyncIterator])try{for(var e=M(n.body),r,a,i;r=!(a=yield new O(e.next())).done;r=!1){const o=a.value;yield t.decode(o)}}catch(o){i=[o]}finally{try{r&&(a=e.return)&&(yield new O(a.call(e)))}finally{if(i)throw i[0]}}else{const o=n.body.getReader();let s;try{for(;!(s=yield new O(o.read())).done;)yield t.decode(s.value)}finally{o.cancel()}}})}function go(n,t){return{[Symbol.asyncIterator](){return at(this,null,function*(){try{let o="";try{for(var e=M(n),r,a,i;r=!(a=yield new O(e.next())).done;r=!1){const s=a.value;if(o+=s,o.indexOf(t)>-1){const l=o.lastIndexOf(t),u=o.slice(0,l).split(t).filter(d=>d.trim().length>0).map(d=>d.slice(d.indexOf(tn)+tn.length).trim());u.length>0&&(yield u),o=o.slice(l+t.length),o.trim()==="--"&&(o="")}}}catch(s){i=[s]}finally{try{r&&(a=e.return)&&(yield new O(a.call(e)))}finally{if(i)throw i[0]}}}catch(o){throw new Error("Error occured while processing stream payload - ".concat(ut(o)))}})}}}function fo(n){return{[Symbol.asyncIterator](){return at(this,null,function*(){const t=yield new O(Ln(n));yield A(f({},t),{hasNext:!1})})}}}function bo(n){return n.map(t=>{try{return JSON.parse(t)}catch(e){throw new Error("Error in parsing multipart response - ".concat(ut(e)))}}).map(t=>{const{data:e,incremental:r,hasNext:a,extensions:i,errors:o}=t;if(!r)return A(f(f({data:e||{}},D("errors",o)),D("extensions",i)),{hasNext:a});const s=r.map(({data:l,path:u,errors:d})=>f({data:l&&u?Nn(u,l):{}},D("errors",d)));return A(f({data:s.length===1?s[0].data:xn([...s.map(({data:l})=>l)])},D("errors",Tn(s))),{hasNext:a})})}function wo(n,t){if(n.length>0)throw new Error(An,{cause:{graphQLErrors:n}});if(Object.keys(t).length===0)throw new Error(_n)}function Co(n,t){var e;const r=(t!=null?t:"").match(so),a="--".concat(r?r[1]:"-");if(!((e=n.body)!=null&&e.getReader)&&!n.body[Symbol.asyncIterator])throw new Error("API multipart response did not return an iterable body",{cause:n});const i=yo(n);let o={},s;return{[Symbol.asyncIterator](){return at(this,null,function*(){var l,u;try{let v=!0;try{for(var d=M(go(i,a)),h,y,p;h=!(y=yield new O(d.next())).done;h=!1){const C=y.value,_=bo(C);s=(u=(l=_.find(Ne=>Ne.extensions))==null?void 0:l.extensions)!=null?u:s;const B=Tn(_);o=xn([o,..._.map(({data:Ne})=>Ne)]),v=_.slice(-1)[0].hasNext,wo(B,o),yield A(f(f({},D("data",o)),D("extensions",s)),{hasNext:v})}}catch(C){p=[C]}finally{try{h&&(y=d.return)&&(yield new O(y.call(d)))}finally{if(p)throw p[0]}}if(v)throw new Error("Response stream terminated unexpectedly")}catch(v){const C=kn(v);yield A(f(f({},D("data",o)),D("extensions",s)),{errors:A(f({message:W(ut(v)),networkStatusCode:n.status},D("graphQLErrors",C==null?void 0:C.graphQLErrors)),{response:n}),hasNext:!1})}})}}}function vo(n){return async(...t)=>{if(!In.test(t[0]))throw new Error(W("This operation does not result in a streamable response - use request() instead."));try{const e=await n(...t),{statusText:r}=e;if(!e.ok)throw new Error(r,{cause:e});const a=e.headers.get("content-type")||"";switch(!0){case a.includes(ie.json):return fo(e);case a.includes(ie.multipart):return Co(e,a);default:throw new Error("".concat(En," ").concat(a),{cause:e})}}catch(e){return{[Symbol.asyncIterator](){return at(this,null,function*(){const r=kn(e);yield{errors:f(f({message:W(ut(e))},D("networkStatusCode",r==null?void 0:r.status)),D("response",r)),hasNext:!1}})}}}}}const So="mutation cartCreate($input:CartInput!$country:CountryCode$language:LanguageCode$withCarrierRates:Boolean=false)@inContext(country:$country language:$language){result:cartCreate(input:$input){...@defer(if:$withCarrierRates){cart{...CartParts}errors:userErrors{...on CartUserError{message field code}}}}}",Ao="mutation cartBillingAddressUpdate($cartId:ID!$billingAddress:MailingAddressInput$country:CountryCode$language:LanguageCode$withCarrierRates:Boolean=false)@inContext(country:$country language:$language){result:cartBillingAddressUpdate(cartId:$cartId billingAddress:$billingAddress){...@defer(if:$withCarrierRates){cart{...CartParts}errors:userErrors{...on CartUserError{message field code}}}}}",Eo="mutation cartBuyerIdentityUpdate($cartId:ID!$buyerIdentity:CartBuyerIdentityInput!$country:CountryCode$language:LanguageCode$withCarrierRates:Boolean=false)@inContext(country:$country language:$language){result:cartBuyerIdentityUpdate(cartId:$cartId buyerIdentity:$buyerIdentity){...@defer(if:$withCarrierRates){cart{...CartParts}errors:userErrors{...on CartUserError{message field code}}}}}",_o="mutation cartSelectedDeliveryOptionsUpdate($cartId:ID!$selectedDeliveryOptions:[CartSelectedDeliveryOptionInput!]!$country:CountryCode=CA$language:LanguageCode=EN$withCarrierRates:Boolean=false)@inContext(country:$country language:$language){result:cartSelectedDeliveryOptionsUpdate(cartId:$cartId selectedDeliveryOptions:$selectedDeliveryOptions){...@defer(if:$withCarrierRates){cart{...CartParts}errors:userErrors{...on CartUserError{message field code}}}}}",Po="mutation applePaySessionCreate($validationUrl:URL!){applePaySessionCreate(validationUrl:$validationUrl){...@defer{applePaySession{body}}}}",Io="mutation PayPalBuyerDetailsFetch($token:String!$cartId:ID){paypalBuyerDetailsFetch(token:$token cartId:$cartId){...@defer{paypalDetails{email expiresAt destinationAddress{...on MailingAddress{address1 address2 city company country firstName lastName phone province zip}}billingAddress{...on MailingAddress{address1 address2 city company country firstName lastName phone province zip}}}}}}",ko="mutation PayPalTokenCreate($cartId:ID!){paypalTokenCreate(cartId:$cartId){...@defer{paypalToken{token}}}}",To="query cartQuery($id:ID!$country:CountryCode$language:LanguageCode$withCarrierRates:Boolean=false)@inContext(country:$country language:$language){cart(id:$id){...@defer(if:$withCarrierRates){...CartParts}}}",Do="query subscriptionPolicyQuery($country:CountryCode$language:LanguageCode)@inContext(country:$country language:$language){shop{subscriptionPolicy(sanitized:true){body}}}",No="mutation cartPaymentUpdate($cartId:ID!$input:CartPaymentInput!$country:CountryCode$language:LanguageCode$withCarrierRates:Boolean=false)@inContext(country:$country language:$language){result:cartPaymentUpdate(cartId:$cartId payment:$input){...@defer(if:$withCarrierRates){cart{...CartParts}errors:userErrors{...on CartUserError{message field code}}}}}",en="fragment CartParts on Cart{id checkoutUrl buyerIdentity{deliveryAddressPreferences{...on MailingAddress{address1 address2 city province phone country firstName lastName zip}}}deliveryGroups(first:10 withCarrierRates:$withCarrierRates){edges{node{id groupType selectedDeliveryOption{code title description handle estimatedCost{amount currencyCode}}deliveryOptions{code title description estimatedCost{amount currencyCode}handle}}}}cost{subtotalAmount{amount currencyCode}totalAmount{amount currencyCode}totalTaxAmount{amount currencyCode}totalDutyAmount{amount currencyCode}}discountAllocations{discountedAmount{amount currencyCode}...on CartCodeDiscountAllocation{code}...on CartAutomaticDiscountAllocation{title}...on CartCustomDiscountAllocation{title}}discountCodes{code applicable}lines(first:10){edges{node{quantity cost{subtotalAmount{amount currencyCode}totalAmount{amount currencyCode}}discountAllocations{discountedAmount{amount currencyCode}...on CartCodeDiscountAllocation{code}...on CartAutomaticDiscountAllocation{title}...on CartCustomDiscountAllocation{title}}merchandise{...on ProductVariant{requiresShipping}}sellingPlanAllocation{priceAdjustments{price{amount currencyCode}}sellingPlan{billingPolicy{...on SellingPlanRecurringBillingPolicy{interval intervalCount}}priceAdjustments{orderCount}recurringDeliveries}}}}}}",Ro="mutation cartSubmitForCompletion($cartId:ID!$attemptToken:String!$country:CountryCode$language:LanguageCode)@inContext(country:$country language:$language){cartSubmitForCompletion(cartId:$cartId attemptToken:$attemptToken){result{__typename ...on SubmitSuccess{redirectUrl}...on SubmitThrottled{pollAfterV2:pollAfter}...on SubmitFailed{errors{code message}}}errors:userErrors{...on CartUserError{code field message}}}}",xo="unstable";class gt extends Error{constructor(t="No response"){super(t),this.name="NoResponseError"}}class Kt{constructor({accessToken:t,country:e,locale:r,apiVersion:a=xo,withCarrierRates:i=!1}){if(c(this,"client"),c(this,"country"),c(this,"locale"),c(this,"withCarrierRates"),!t)throw new Error("StorefrontApiClient constructed with no access token");if(!e)throw new Error("StorefrontApiClient constructed with no buyer country");if(!r)throw new Error("StorefrontApiClient constructed with no locale");this.country=e,this.locale=r,this.withCarrierRates=i;const o="/api/".concat(a,"/graphql.json");this.client=uo({headers:{"Content-Type":"application/json",Accept:"application/json","X-Shopify-Storefront-Access-Token":t,"X-SDK-Variant":"portable-wallets"},url:o,retries:0,logger:s=>{if(s.type==="HTTP-Response"){const[l,u]=s.content.requestParams;g.leaveBreadcrumb("POST: ".concat(l),{statusCode:s.content.response.status,statusText:s.content.response.statusText,url:l,method:u==null?void 0:u.method,headers:u==null?void 0:u.headers,body:u==null?void 0:u.body},"request")}}})}async createCart(t){var e;return this.requestDeferredCart(So,{input:{lines:[{merchandiseId:t.merchandiseId,quantity:t.quantity,sellingPlanId:t.sellingPlanId,attributes:Object.entries((e=t.lineItemProperties)!=null?e:{}).map(([r,a])=>({key:r,value:a}))}],discountCodes:t.discountCodes,buyerIdentity:t.buyerIdentity}})}async updateCartBillingAddress(t){const{cartId:e,billingAddress:r}=t;return this.requestDeferredCart(Ao,{cartId:e,billingAddress:r})}async updateCartBuyerIdentity(t){const{cartId:e,emailAddress:r,streetAddress:a,countryCode:i,phone:o,preferences:s}=t;return this.requestDeferredCart(Eo,{cartId:e,buyerIdentity:{email:r,countryCode:i!=null?i:a==null?void 0:a.country,phone:o!=null?o:a==null?void 0:a.phone,deliveryAddressPreferences:a?[{deliveryAddressValidationStrategy:t.validateAddress?"STRICT":"COUNTRY_CODE_ONLY",deliveryAddress:a}]:[],preferences:s}})}async updateSelectedDeliveryOptions(t,e,r){let a=e;const i=Date.now()+2e4;for(;Date.now()<i&&!(r!=null&&r.aborted);){const o=await this.requestDeferredCart(_o,{cartId:t,selectedDeliveryOptions:a});if(!o.errors.some(l=>l.startsWith(b.PendingDeliveryGroups)))return o;const s=o.data.deliveryGroups.flatMap(l=>l.deliveryOptions.map(u=>({deliveryOptionHandle:u.handle,deliveryGroupId:l.id})));a=a.map(l=>{var u;return(u=s.find(d=>d.deliveryOptionHandle===l.deliveryOptionHandle))!=null?u:l})}throw new Error("Selected delivery options update operation timed out")}async applePaySessionCreate(t){var e,r,a;const i=await this.requestStream([Po],{validationUrl:t.toString()});try{for(var o=M(i),s,l,u;s=!(l=await o.next()).done;s=!1){const d=l.value;d.errors&&this.onError(d.errors);const h=(a=(r=(e=d.data)==null?void 0:e.applePaySessionCreate)==null?void 0:r.applePaySession)==null?void 0:a.body;if(h)return h}}catch(d){u=[d]}finally{try{s&&(l=o.return)&&await l.call(o)}finally{if(u)throw u[0]}}throw new gt("Apple Pay session create operation returned no response")}async paypalBuyerDetailsFetch(t,e){var r,a;const i=await this.requestStream([Io],{token:t,cartId:e});try{for(var o=M(i),s,l,u;s=!(l=await o.next()).done;s=!1){const d=l.value;if(d.hasNext)continue;d.errors&&this.onError(d.errors);const h=(a=(r=d.data)==null?void 0:r.paypalBuyerDetailsFetch)==null?void 0:a.paypalDetails;if(h)return h}}catch(d){u=[d]}finally{try{s&&(l=o.return)&&await l.call(o)}finally{if(u)throw u[0]}}throw new gt("PayPal buyer details fetch operation returned no response")}async paypalTokenCreate(t){var e,r,a;const i=await this.requestStream([ko],{cartId:t});try{for(var o=M(i),s,l,u;s=!(l=await o.next()).done;s=!1){const d=l.value;d.errors&&this.onError(d.errors);const h=(a=(r=(e=d.data)==null?void 0:e.paypalTokenCreate)==null?void 0:r.paypalToken)==null?void 0:a.token;if(h)return h}}catch(d){u=[d]}finally{try{s&&(l=o.return)&&await l.call(o)}finally{if(u)throw u[0]}}throw new gt("PayPal token create operation returned no response")}async fetchCart(t){var e;const r=this.formatLanguage(this.locale),a=await this.requestStream([To,en],{id:t,country:this.country,language:r,withCarrierRates:this.withCarrierRates});try{for(var i=M(a),o,s,l;o=!(s=await i.next()).done;o=!1){const u=s.value;u.errors&&this.onError(u.errors);const d=(e=u.data)==null?void 0:e.cart;if(g.leaveBreadcrumb("Fetch cart response",{body:d,hasNext:u.hasNext},"log"),d&&!u.hasNext)return this.parseCartResponse(d)}}catch(u){l=[u]}finally{try{o&&(s=i.return)&&await s.call(i)}finally{if(l)throw l[0]}}throw new gt("Cart fetch operation returned no response")}async updateCartPayment(t,e,r){var a,i;const o={cartId:t,input:e},{amount:s,currencyCode:l}=e.amount;let u;const d=Date.now()+1e4;for(;Date.now()<d&&!(r!=null&&r.aborted);){const h=await this.requestDeferredCart(No,o);if(u||(u=h),h.errors.includes(b.InvalidPaymentAmount)){parseFloat((i=(a=h.data.totalTaxAmount)==null?void 0:a.amount)!=null?i:"0")===0&&await new Promise(y=>setTimeout(y,500)),o.input.amount={amount:h.data.totalAmount.amount,currencyCode:h.data.totalAmount.currencyCode};continue}return(h.data.totalAmount.amount===s||parseFloat(h.data.totalAmount.amount)<=parseFloat(s))&&h.data.totalAmount.currencyCode===l?h:u}throw new Error("Payment update operation timed out")}async submitForCompletion(t,e){var r,a;const i=this.formatLanguage(this.locale),o=await this.request([Ro],{cartId:t,attemptToken:e,country:this.country,language:i,withCarrierRates:this.withCarrierRates});return{data:(a=(r=o.data)==null?void 0:r.cartSubmitForCompletion)==null?void 0:a.result,errors:this.parseCompletionErrors(o)}}async fetchSubscriptionPolicy(){var t,e;const{data:r}=await this.request([Do],{country:this.country,language:this.formatLanguage(this.locale)});return(e=(t=r==null?void 0:r.shop)==null?void 0:t.subscriptionPolicy)==null?void 0:e.body}async request(t,e){return this.client.request(t.join(""),{variables:e})}async requestStream(t,e){return this.client.requestStream(t.join(""),{variables:e})}async requestDeferredCart(t,e){var r,a;const i=this.formatLanguage(this.locale),o=await this.requestStream([t,en],A(f({},e),{country:this.country,language:i,withCarrierRates:this.withCarrierRates}));try{for(var s=M(o),l,u,d;l=!(u=await s.next()).done;l=!1){const h=u.value;h.errors&&this.onError(h.errors);const y=(a=(r=h.data)==null?void 0:r.result)==null?void 0:a.cart;if(y&&!h.hasNext)return{data:await this.fetchCart(y.id),errors:this.parseMutationErrors(h,"result")}}}catch(h){d=[h]}finally{try{l&&(u=s.return)&&await u.call(s)}finally{if(d)throw d[0]}}throw new gt("Deferred cart operation returned no response")}onError(t){var e,r;if(!t)return;g.leaveBreadcrumb("GraphQL response error",t,"error");const a=(r=(e=t.graphQLErrors)==null?void 0:e.map(s=>s.message).join(", "))!=null?r:"",i="".concat(t.message).concat(a.length>0?" - ".concat(a):""),o=t!=null&&t.networkStatusCode?"with status ".concat(t.networkStatusCode," => ").concat(i):"=> ".concat(i);throw new Error("GraphQL mutation failed ".concat(o))}formatLanguage(t){return t.includes("-")?t.split("-")[0].toUpperCase():t.toUpperCase()}parseCartResponse(t){var e,r,a;const i=t.lines.edges.map(s=>{var l,u;const d=s.node;return{quantity:d.quantity,totalAmount:{amount:d.cost.totalAmount.amount,currencyCode:d.cost.totalAmount.currencyCode},subtotalAmount:{amount:(l=d.cost.subtotalAmount)==null?void 0:l.amount,currencyCode:(u=d.cost.subtotalAmount)==null?void 0:u.currencyCode},merchandise:{requiresShipping:d.merchandise.requiresShipping},discountAllocations:d.discountAllocations,sellingPlanAllocation:d.sellingPlanAllocation}}),o=t.deliveryGroups.edges.map(s=>s.node);return{id:t.id,totalAmount:t.cost.totalAmount,subtotalAmount:(e=t.cost.subtotalAmount)!=null?e:void 0,totalTaxAmount:(r=t.cost.totalTaxAmount)!=null?r:void 0,totalDutyAmount:(a=t.cost.totalDutyAmount)!=null?a:void 0,discountAllocations:t.discountAllocations,discountCodes:t.discountCodes,lineItems:i,deliveryGroups:o,checkoutUrl:t.checkoutUrl}}parseGraphQlErrors(t){var e,r;return(r=(e=t==null?void 0:t.graphQLErrors)==null?void 0:e.map(a=>a.message.replace(/\(Expected.*\)/,"").trim()))!=null?r:[]}parseMutationErrors(t,e){var r,a,i;const o=this.parseGraphQlErrors(t.errors),s=((i=(a=(r=t.data)==null?void 0:r[e])==null?void 0:a.errors)==null?void 0:i.map(u=>u.field&&u.field.length>0?"".concat(u.code,": ").concat(u.field.join(".")):u.code).filter(u=>u))||[],l=[...o,...s];return g.leaveBreadcrumb("GraphQL errors on mutation",l,"error"),l}parseCompletionErrors(t){var e,r,a,i;const o=this.parseGraphQlErrors(t.errors);let s=[];((a=(r=(e=t.data)==null?void 0:e.cartSubmitForCompletion)==null?void 0:r.result)==null?void 0:a.__typename)==="SubmitFailed"&&(s=(i=t.data.cartSubmitForCompletion.result.errors.map(u=>u.code))!=null?i:[]);const l=[...o,...s];return g.leaveBreadcrumb("GraphQL errors on completion",l,"error"),l}}async function Lo({cartId:n,cartClient:t,instrumentName:e,selectedDeliveryOptions:r,abortSignal:a}){try{if(!n)throw new Error("[".concat(e,"] provided no cart ID when updating shipping method"));if(!t)throw new Error("[".concat(e,"] provided invalid cart client when updating shipping method"));return await t.updateSelectedDeliveryOptions(n,r,a)}catch(i){throw m.updateFailed(e,"updateSelectedDeliveryOptions"),i}}async function Oo({cartId:n,token:t,cartClient:e,instrumentName:r}){try{if(!n)throw new Error("[".concat(r,"] provided no cart ID when submitting for completion"));if(!e)throw new Error("[".concat(r,"] provided invalid cart client when submitting for completion"));if(!t)throw new Error("[".concat(r,"] provided no token when submitting for completion"));return await e.submitForCompletion(n,t)}catch(a){throw m.updateFailed(r,"submitForCompletion"),a}}function Fo({selectedDeliveryOptionHandles:n,deliveryGroups:t,instrumentName:e}){return t.map(r=>{const a=r.deliveryOptions.filter(i=>n.includes(i.handle));if(!a.length)throw new Error("[".concat(e,"] could not find delivery option for group: ").concat(r.id));if(a.length>1)throw new Error("[".concat(e,"] found multiple delivery options with selectedDeliverOptionHandle in group: ").concat(r.id));return{deliveryGroupId:r.id,deliveryOptionHandle:a[0].handle}})}async function $o(n){const{cartClient:t,instrumentName:e}=n;try{if(!n.cartId)throw new Error("[".concat(e,"] provided no cart ID when updating billing address"));if(!t)throw new Error("[".concat(e,"] provided invalid cart client when updating billing address"));return await t.updateCartBillingAddress(n)}catch(r){throw m.updateFailed(e,"updateBillingAddress"),r}}class Bo{constructor({accessToken:t,buyerCountry:e,buyerCurrency:r,button:a,i18n:i,merchantName:o,dataSource:s,apiClient:l,walletParams:u}){c(this,"name",w.ApplePay),c(this,"accessToken"),c(this,"button"),c(this,"buyerCountry"),c(this,"cart"),c(this,"apiClient"),c(this,"dataSource"),c(this,"i18n"),c(this,"merchantName"),c(this,"session"),c(this,"paymentSheetActionGenerator"),c(this,"cancelled"),c(this,"buyerCurrency"),c(this,"customerAccountEmail"),c(this,"abortController",null),c(this,"begin",()=>{g.leaveBreadcrumb("ApplePay Session begin",{},"log"),this.abortController=typeof AbortController=="function"&&new AbortController||null,this.session.begin()}),c(this,"onvalidatemerchant",async d=>{try{const h=new URL(d.validationURL),y=this.getMerchantSession(h),{cart:p}=await nt({element:this.button,instrumentName:this.name,dataSource:this.dataSource});this.cart=p;const v=await y;if(g.leaveBreadcrumb("ApplePay Session completeMerchantValidation",{session:v},"log"),this.sessionIsCancelled())return;this.session.completeMerchantValidation(v)}catch(h){m.sheetClicked({instrument:w.ApplePay,result:"failed"}),this.terminateSession(h)}}),c(this,"onshippingcontactselected",async d=>{try{const h=_t(d.shippingContact),y=await kt({cartId:this.cart.id,streetAddress:h,cartClient:this.apiClient,instrumentName:this.name});if(this.decelerateIfCurrencyChanged(y.data))return;await this.applyPaymentSheetActions(y,p=>this.completeShippingContactSelection(y.data,p),{shippingRequired:this.isShippingRequired})}catch(h){this.terminateSession(h)}}),c(this,"onshippingmethodselected",async d=>{var h;try{const y=d.shippingMethod.identifier.split(","),p=Fo({selectedDeliveryOptionHandles:y,deliveryGroups:this.cart.deliveryGroups,instrumentName:this.name}),v=await Lo({cartId:this.cart.id,cartClient:this.apiClient,instrumentName:this.name,selectedDeliveryOptions:p,abortSignal:(h=this.abortController)==null?void 0:h.signal});await this.applyPaymentSheetActions(v,()=>this.completeShippingMethodSelection(v.data))}catch(y){this.terminateSession(y)}}),c(this,"onpaymentmethodselected",async d=>{try{const{billingContact:h}=d.paymentMethod;if(!this.isShippingRequired&&h){const v=_t(h),C=await kt({cartId:this.cart.id,countryCode:v.country,cartClient:this.apiClient,instrumentName:this.name});if(this.decelerateIfCurrencyChanged(C.data))return;await this.applyPaymentSheetActions(C,()=>this.cart=C.data);const _=await $o({billingAddress:v,cartId:this.cart.id,cartClient:this.apiClient,instrumentName:this.name});await this.applyPaymentSheetActions(_,()=>this.cart=_.data)}const{newTotal:y,newLineItems:p}=this.getNewTotalAndLineItems(this.cart);if(g.leaveBreadcrumb("ApplePay Session completePaymentMethodSelection",{newTotal:y,newLineItems:p},"log"),this.sessionIsCancelled())return;this.session.completePaymentMethodSelection({newTotal:y,newLineItems:p})}catch(h){this.terminateSession(h)}}),c(this,"oncancel",()=>{var d;this.cancelled=!0,m.sheetCancelled(this.name),this.button.disabled=!1,(d=this.abortController)==null||d.abort()}),c(this,"onpaymentauthorized",async d=>{m.authorizationAttempt(this.name),qt(N.AuthorizationLatency,this.name);const h=S=>{m.authorizationComplete({instrument:this.name,measurement:tt(N.AuthorizationLatency,this.name),result:"failure"}),this.terminateSession(S)},y=async S=>{var _e,ke;switch((_e=S.effects)==null||_e.forEach(Pe=>Pe()),S.action){case"complete":{const Pe=ApplePaySession.STATUS_SUCCESS;try{await this.completePayment(Pe),et(S.redirectUrl)}catch(Ie){h(Ie)}break}case"show_error":{const Pe=(ke=S.errors)!=null?ke:[];try{await this.completePayment(ApplePaySession.STATUS_FAILURE,Pe)}catch(Ie){h(Ie)}break}case"abort":{try{await this.completePayment(ApplePaySession.STATUS_FAILURE),this.button.disabled=!1}catch(Pe){h(Pe)}break}default:h(new Error("[".concat(this.name,"] completion action not handled: ").concat(S.action)))}},{token:p,billingContact:v,shippingContact:C}=d.payment;let _=null,B=null;try{if(!v){await this.completePayment(ApplePaySession.STATUS_FAILURE);return}if(_=_t(A(f({},v),{phoneNumber:C==null?void 0:C.phoneNumber})),this.isShippingRequired){if(!C){await this.completePayment(ApplePaySession.STATUS_FAILURE);return}B=_t(C)}}catch(S){h(S);return}const Ne=async()=>{var S;try{const _e=this.isShippingRequired?{validateAddress:!0,streetAddress:B}:{},ke=(S=this.customerAccountEmail)!=null?S:C==null?void 0:C.emailAddress,Pe=await kt(f({cartId:this.cart.id,emailAddress:ke,cartClient:this.apiClient,instrumentName:this.name},_e)),Ie=this.paymentSheetActionGenerator.mapMutationResultToPaymentSheetAction(Pe);await Gt({paymentSheetAction:Ie,onProceed:async De=>{De&&De.length>0?await this.completePayment(ApplePaySession.STATUS_FAILURE,De):await Oe()},terminateSession:h})}catch(_e){h(_e)}},Oe=async()=>{var S;try{const _e=this.cart.lineItems.some(Ie=>!!Ie.sellingPlanAllocation),ke=await Cn({cartId:this.cart.id,totalAmount:this.cart.totalAmount,paymentMethod:{walletPaymentMethod:{applePayWalletContent:{billingAddress:_,data:p.paymentData.data,header:p.paymentData.header,lastDigits:p.paymentMethod.displayName.split(" ")[1],signature:p.paymentData.signature,version:p.paymentData.version}}},canUsePaymentMethodForFreeOrder:!1,billingAddress:_,cartClient:this.apiClient,instrumentName:this.name,hasSellingPlan:_e,abortSignal:(S=this.abortController)==null?void 0:S.signal}),Pe=this.paymentSheetActionGenerator.mapMutationResultToPaymentSheetAction(ke);await Gt({paymentSheetAction:Pe,onProceed:async Ie=>{Ie&&Ie.length>0?await this.completePayment(ApplePaySession.STATUS_FAILURE,Ie):await Fe()},terminateSession:h})}catch(_e){h(_e)}},Fe=async()=>{try{const S=await Oo({cartId:this.cart.id,token:p.transactionIdentifier,cartClient:this.apiClient,instrumentName:this.name}),_e=this.paymentSheetActionGenerator.mapCompletionResultToPaymentSheetAction(S);await y(_e)}catch(S){h(S)}};await Ne()}),c(this,"terminateSession",d=>{var h;this.button.disabled=!1,d&&g.notify(d),m.sheetFailed(this.name,d);try{g.leaveBreadcrumb("ApplePay Session abort",{},"log"),this.session.abort(),(h=this.abortController)==null||h.abort()}catch(y){g.notify(y)}if(d){const y=this.i18n.translate("brand.apple_pay");H(this.i18n.translate("error_dialogs.wallet.title",{wallet:y}),this.i18n.translate("error_dialogs.wallet.generic_error",{wallet:y}))}}),c(this,"getMostRecentNonNullCart",(d,h)=>d?(this.cart=d,d):h),c(this,"handleNullCart",d=>{if(!d)throw new Error("[".concat(this.name,"] no cart returned on mutation, aborting"))}),c(this,"completeShippingContactSelection",(d,h)=>{try{const y=this.getMostRecentNonNullCart(d,this.cart),{newTotal:p,newLineItems:v}=this.getNewTotalAndLineItems(y),C=Ya(y.deliveryGroups,this.i18n);g.leaveBreadcrumb("ApplePay Session completeShippingContactSelection",{errors:h,newTotal:p,newLineItems:v,newShippingMethods:C},"log"),this.session.completeShippingContactSelection({errors:h!=null?h:[],newTotal:p,newLineItems:v,newShippingMethods:C})}catch(y){this.terminateSession(y)}}),c(this,"completeShippingMethodSelection",d=>{try{this.handleNullCart(d),this.cart=d;const{newTotal:h,newLineItems:y}=this.getNewTotalAndLineItems(d);g.leaveBreadcrumb("ApplePay Session completeShippingContactSelection",{newTotal:h,newLineItems:y},"log"),this.session.completeShippingMethodSelection({newTotal:h,newLineItems:y})}catch(h){this.terminateSession(h)}}),c(this,"sessionIsCancelled",()=>this.cancelled),this.accessToken=t,this.buyerCountry=e,this.button=a,this.cart=null,this.apiClient=l,this.dataSource=s,this.i18n=i,this.merchantName=o,this.cancelled=!1,this.buyerCurrency=r,this.customerAccountEmail=u.customerAccountEmail,this.session=new ApplePaySession(sn,Za({shippingRequired:this.isShippingRequired,walletParams:u,buyerCurrency:r})),this.session.onvalidatemerchant=this.onvalidatemerchant,this.session.onshippingcontactselected=this.onshippingcontactselected,this.session.onshippingmethodselected=this.onshippingmethodselected,this.session.onpaymentmethodselected=this.onpaymentmethodselected,this.session.oncancel=this.oncancel,this.session.onpaymentauthorized=this.onpaymentauthorized,this.paymentSheetActionGenerator=new Xa(i)}async applyPaymentSheetActions(t,e,r){var a;const i=this.paymentSheetActionGenerator.mapMutationResultToPaymentSheetAction(t,r);(a=i.effects)==null||a.forEach(o=>o()),!this.sessionIsCancelled()&&await Gt({paymentSheetAction:i,onProceed:e,terminateSession:this.terminateSession})}async getMerchantSession(t){const e=await new Kt({accessToken:this.accessToken,country:this.buyerCountry,locale:this.i18n.locale,apiVersion:"unstable"}).applePaySessionCreate(t);return JSON.parse(e)}async completePayment(t,e=void 0){g.leaveBreadcrumb("ApplePay Session completePayment",{status:t,errors:e},"log"),this.session.completePayment({status:t,errors:e}),m.authorizationComplete({instrument:this.name,measurement:tt(N.AuthorizationLatency,this.name),result:t===ApplePaySession.STATUS_SUCCESS?"success":"failure"})}getNewTotalAndLineItems(t){return{newTotal:za(this.merchantName,t.totalAmount),newLineItems:qa({subtotal:to(t),discountAllocations:eo(t),deliveryGroups:t.deliveryGroups,duties:t.totalDutyAmount,taxes:t.totalTaxAmount,i18n:this.i18n,formattedRecurringTotals:no(this.cart.lineItems,this.i18n)})}}decelerateIfCurrencyChanged(t){const e=t!=null?t:this.cart;return vn({cart:e,buyerCurrency:this.buyerCurrency,instrumentName:this.name})?(this.terminateSession(),!0):!1}get isShippingRequired(){return this.button.isShippingRequired}}const Mo='<svg viewBox="0 0 43 19" xmlns="http://www.w3.org/2000/svg" width="45px" style="width: 45px;">\n  <path d="M6.948 1.409C7.934.147 9.305.147 9.305.147s.193 1.18-.771 2.316c-1.05 1.2-2.228.993-2.228.993s-.236-.93.642-2.047zM3.82 3.663c-1.735 0-3.6 1.51-3.6 4.363 0 2.916 2.186 6.555 3.943 6.555.6 0 1.543-.6 2.485-.6.922 0 1.607.559 2.464.559 1.907 0 3.322-3.826 3.322-3.826s-2.015-.744-2.015-2.936c0-1.944 1.629-2.73 1.629-2.73s-.836-1.447-2.936-1.447c-1.22 0-2.164.661-2.656.661-.622.021-1.5-.6-2.636-.6zM19.64 1.426c2.453 0 4.188 1.788 4.188 4.396 0 2.608-1.755 4.417-4.248 4.417h-2.932v4.564h-1.974V1.426h4.966zm-2.992 7.067h2.473c1.695 0 2.693-.967 2.693-2.65 0-1.683-.978-2.671-2.693-2.671h-2.473v5.321zm7.559 3.429c0-1.767 1.296-2.777 3.65-2.945l2.572-.147v-.78c0-1.156-.738-1.787-1.994-1.787-1.037 0-1.795.568-1.955 1.43h-1.775c.06-1.788 1.656-3.092 3.79-3.092 2.333 0 3.829 1.304 3.829 3.281v6.9h-1.815v-1.684h-.04c-.519 1.094-1.715 1.788-3.012 1.788-1.934.021-3.25-1.178-3.25-2.965zm6.222-.905v-.778l-2.313.168c-1.297.084-1.975.59-1.975 1.494 0 .862.718 1.409 1.815 1.409 1.396-.021 2.473-.968 2.473-2.293zm3.969 7.383v-1.64c.14.041.438.041.598.041.897 0 1.416-.4 1.735-1.472l.14-.526L33.4 4.707h2.054l2.453 8.224h.04L40.4 4.707h1.994l-3.57 10.538c-.818 2.419-1.715 3.197-3.67 3.197-.14.02-.598-.021-.757-.042z"/>\n</svg>\n';function On({buttonContent:n,logoElement:t,setAriaHidden:e}){const r=document.createElement("div");return n.split(new RegExp("(".concat(Xt,")"))).filter(Boolean).map(a=>{let i;a===Xt?i=t:(i=document.createElement("span"),i.innerText=a,e&&i.setAttribute("aria-hidden","true")),r.appendChild(i)}),r}class Uo extends V{constructor(){super(),c(this,"name",w.ApplePay),c(this,"fragment",null),c(this,"button",null),c(this,"logoElement"),this.logoElement=new DOMParser().parseFromString(Mo,"image/svg+xml").documentElement}static get observedAttributes(){return["disabled"]}get merchantName(){return this.walletParams.merchantName}connectedCallback(){this.cleanupOnFailure(this.render.bind(this),this.name)}attributeChangedCallback(t,e,r){super.attributeChangedCallback(t,e,r,this.button)}async handleClick(t){if(t.preventDefault(),this.disabled||!this.button||this.button.hasAttribute("aria-disabled"))return;this.disabled=!0;const[e,r,a]=await Promise.all([this.i18n,this.dataSource,this.apiClient]);let i;try{if(i=new Bo({accessToken:this.accessToken,buyerCountry:this.buyerCountry,buyerCurrency:this.buyerCurrency,button:this,i18n:e,merchantName:this.merchantName,dataSource:r,apiClient:a,walletParams:this.walletParams}),!i)throw new Error("missing ApplePaySession");i.begin(),m.sheetClicked({instrument:this.name,result:"success"})}catch(o){g.notify(o),m.sheetClicked({instrument:this.name,result:"failed"}),i==null||i.terminateSession()}}async render(){var t;if(!this.button){const e=await this.classNames;this.button=Mt(),this.button.onclick=a=>this.handleClick(a),this.button.className="apple-pay-button ".concat(cr[this.buttonTheme]," ").concat(e);const r=this.hasAttribute("call-to-action");await this.addBranding(this.button,r)}if(this.disabled&&this.button.setAttribute("aria-disabled","true"),!this.fragment){this.fragment=document.createDocumentFragment();const e=document.createElement("style");e.innerHTML=Ma,this.fragment.append(e,this.button),this.appendChild(this.fragment),(t=this.onRendered)==null||t.call(this)}}async addBranding(t,e){const r=await this.i18n,a=r.translate("buy_with_button_content"),i=r.translate("brand.apple_pay");t.setAttribute("aria-label",e?a.replace(Xt,i):i),t.appendChild(this.htmlContent(e?a:null))}htmlContent(t){if(!t)return this.logoElement;const e=On({buttonContent:t,logoElement:this.logoElement,setAriaHidden:!0});return e.classList.add("apple-pay--content"),e}}function ve(n){return function(t,e,r){const a=r.value;return r.value=function(...i){const o=a.apply(this,i);return o.eligible||console.debug("[DEBUG] ".concat(n," could not be rendered. Reason: ").concat(o.reason)),o},r}}var zo=Object.defineProperty,qo=Object.getOwnPropertyDescriptor,Fn=(n,t,e,r)=>{for(var a=r>1?void 0:r?qo(t,e):t,i=n.length-1,o;i>=0;i--)(o=n[i])&&(a=(r?o(t,e,a):o(a))||a);return r&&a&&zo(t,e,a),a};class Se extends G{constructor(t){super(t),c(this,"companyFieldRequired"),this.companyFieldRequired=!!this.walletParams.companyRequired}static walletName(){return"apple_pay"}getWebComponentName(){return"shopify-apple-pay-button"}getWebComponentClass(){return Uo}getInstrumentName(){return w.ApplePay}applePayInIframe(){return typeof window>"u"||window.self!==window.top}getLoadEligibility(){return this.applePayInIframe()?{eligible:!1,reason:"cannot be loaded in an iframe"}:{eligible:!0}}getPartnerSDKEligibility(){var t,e,r,a;return typeof window>"u"||window.ApplePaySession===void 0?{eligible:!1,reason:"window or ApplePaySession is undefined"}:(e=(t=window.ApplePaySession).supportsVersion)!=null&&e.call(t,sn)?(a=(r=window.ApplePaySession).canMakePayments)!=null&&a.call(r)?{eligible:!0}:{eligible:!1,reason:"failed SDK eligibility check"}:{eligible:!1,reason:"SDK does not meet minimum version requirement"}}}Fn([ve("Apple Pay")],Se.prototype,"getLoadEligibility",1),Fn([ve("Apple Pay")],Se.prototype,"getPartnerSDKEligibility",1);const Ho=".buy-with-prime-button:hover:enabled{background-color:#0684eb!important}.buy-with-prime-button:focus{box-shadow:0 0 0 2px #1a98ff,inset 0 0 0 2px rgb(var(--color-background))!important;outline:none!important}.buy-with-prime-button:active,.buy-with-prime-button:hover:enabled:active{background-color:#0066cd!important;box-shadow:none!important}";class Tt extends Error{constructor(){super(...arguments),c(this,"name","MissingAccessTokenError")}}class Ae extends Error{constructor(){super(...arguments),c(this,"name","FetchingWalletsPlatformConfigError")}}class $n extends Error{constructor(){super(...arguments),c(this,"name","EmptyLineItemsWalletsPlatformConfigError")}}async function Bn({configOptionsEndpoint:n,checkoutUrl:t,sourceId:e,accessToken:r,instrument:a}){try{const i=JSON.stringify({checkout_url:t,checkout_cancel_url:window.location.href,cart_id:e}),o=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json","X-Shopify-Storefront-Access-Token":r},body:i});if(o.ok)return o.json();const s=await o.json();throw s.error?new Error(s.error):new Error("Could not fetch wallets platform configs: [".concat(o.status,"] ").concat(o.statusText))}catch(i){const{message:o}=i!=null?i:{};switch(o){case"empty_line_items":throw new $n("[Fetch Pay Config][".concat(a,"] No eligible line items provided in the config request."));default:throw new Ae("[Fetch Pay Config][".concat(a,"] ").concat(o))}}}const it=class Be extends V{constructor(){super(...arguments),c(this,"name",w.BuyWithPrime),c(this,"fragment",null),c(this,"button",null)}connectedCallback(){this.cleanupOnFailure(this.render.bind(this),this.name)}disconnectedCallback(){}createButton(){const t=Mt();return t.type="button",t.role="button",t.className="buy-with-prime-button",X(t,{width:"100%","padding-top":"12px","padding-bottom":"8px","padding-right":"10px","padding-left":"10px",display:"flex","align-items":"center","justify-content":"center",gap:"5px",opacity:"1","border-width":"0px"}),this.applyEnabledStyles(t),t}applyEnabledStyles(t){t.innerHTML=St.primeLogo,t.disabled=!1,X(t,{"background-color":"#1A98FF",color:"#FFFFFF",cursor:"pointer"})}applyDisabledStyles(t){t.innerHTML=St.primeLogoDark,t.disabled=!0,X(t,{"background-color":"#C0E3FF",color:"#7292AC",cursor:"not-allowed"})}async handleClick(){var t;if(!this.button)return;const[e,r]=await Promise.all([this.i18n,this.dataSource]);let a,i;try{this.applyDisabledStyles(this.button);let o=this.walletParams;if(a=o.appId,!o.createCheckoutSessionConfig){if(i=(await nt({element:this,instrumentName:this.name,dataSource:r})).cart,!this.accessToken)throw new Tt("[Fetch Pay Config] could not fetch pay configs since required accessToken is missing.");o=A(f({},await Bn({configOptionsEndpoint:Be.OPTIMUS_CONFIG_REST_API_URL,checkoutUrl:i.checkoutUrl,sourceId:(t=Bt(i))!=null?t:"",accessToken:this.accessToken,instrument:this.name})),{placement:this.pageType===k.ProductPage?"Product":"Cart"})}delete o.checkoutSupportsSplitCart,delete o.appId,window.amazon.buywithprime.initCheckout({amazonPayOptions:o}),m.sheetClicked({instrument:this.name,result:"success",webPixelMetaData:a?{apiClientId:a,cart:i}:void 0})}catch(o){const{name:s}=o!=null?o:{};Be.EXPECTED_ERRORS.includes(s)||g.notify(o),m.sheetClicked({instrument:this.name,result:"failed",webPixelMetaData:a?{apiClientId:a,cart:i}:void 0});const{title:l,content:u}=this.getErrorCopies(s,e);H(l,u)}finally{this.applyEnabledStyles(this.button)}}getErrorCopies(t,e){const r=e.translate("brand.buy_with_prime");switch(t){case"EmptyLineItemsWalletsPlatformConfigError":return{title:e.translate("error_dialogs.wallet.buy_with_prime.empty_line_items.title"),content:e.translate("error_dialogs.wallet.buy_with_prime.empty_line_items.content")};default:return{title:e.translate("error_dialogs.wallet.title",{wallet:r}),content:e.translate("error_dialogs.wallet.generic_error",{wallet:r})}}}async render(){var t;if(!this.button){const e=await this.classNames;this.button=this.createButton(),this.button.onclick=()=>this.handleClick(),this.button.className="buy-with-prime-button ".concat(e)}if(!this.fragment){this.fragment=document.createDocumentFragment();const e=document.createElement("style");e.innerHTML=Ho,this.fragment.append(e,this.button),this.appendChild(this.fragment)}(t=this.onRendered)==null||t.call(this)}};c(it,"OPTIMUS_CONFIG_REST_API_URL","".concat(window.location.origin,"/wallets/config/optimus")),c(it,"EXPECTED_ERRORS",[Ae.name,Tt.name,$n.name]);let se=it;async function Yt(n){const t=n.createCheckoutSessionConfig,e=JSON.parse(t.payloadJSON),r=new URL(e.webCheckoutDetails.checkoutReviewReturnUrl),a=await(await fetch("https:///sandbox/v2/checkoutSessions",{method:"POST",body:JSON.stringify(n),headers:{Accept:"application/json","Content-Type":"application/json;charset=UTF-8"}})).json();r.searchParams.set("amazonCheckoutSessionId",a.checkoutSessionId||"testCheckoutSessionId"),r.searchParams.set("promiseId","testPromiseId"),et(r.toString())}const Mn={buywithprime:{initCheckout:async n=>{Yt(n.amazonPayOptions)}},Pay:{initCheckout:async n=>{Yt(n)},renderButton:()=>({initCheckout:Yt,onClick:()=>{}})}};async function Ko(){return window.amazon=Mn,"loaded"}async function Wo(n){return new Promise((t,e)=>{if(document.querySelector('script[src="'.concat(n,'"]'))&&window.amazon){t();return}const r=document.createElement("script");r.src=n,r.onload=()=>{window.amazon?t():e(new Error("Amazon SDK not present after loading"))},r.onerror=()=>{e(new Error("Error loading Amazon SDK"))},document.head.append(r)})}async function Un({sdkUrl:n=me,maxRetries:t=3,shouldMock:e=!1}){let r=0;if(e){await Ko();return}do try{await Wo(n);break}catch(a){if(r++,r===t)throw a}while(r<t)}const F=class Te extends G{static walletName(){return"buy_with_prime"}constructor(t){super(t)}getWebComponentName(){return"shopify-buy-with-prime-button"}getInstrumentName(){return w.BuyWithPrime}isMockedAmazonServiceUsed(){return!1}getWebComponentClass(){return se}async loadWalletSDK(){await Un({sdkUrl:Te.SDK_URL,shouldMock:this.isMockedAmazonServiceUsed(),maxRetries:Te.MAX_RETRIES}),await this.loadLogos()}async loadLogos(){await Promise.all([this.loadPrimeLogo(),this.loadPrimeLogoDark()])}async loadPrimeLogo(){Te.primeLogo=(await import("./prime-logo-CaEyIrNK.js")).default}async loadPrimeLogoDark(){Te.primeLogoDark=(await import("./prime-logo-dark-C_wGaFh_.js")).default}};c(F,"MAX_RETRIES",3),c(F,"SDK_URL",me),c(F,"primeLogo"),c(F,"primeLogoDark");let St=F;const z=class Le extends V{constructor(){super(...arguments),c(this,"name",w.AmazonPay),c(this,"container",null)}connectedCallback(){this.cleanupOnFailure(this.render.bind(this),this.name)}async handleClick(t){var e;const[r,a]=await Promise.all([this.i18n,this.dataSource]);try{const{cart:i}=await nt({element:this,instrumentName:this.name,dataSource:a}),{totalAmount:{amount:o},checkoutUrl:s}=i;let l=this.walletParams;if(!l.createCheckoutSessionConfig){if(!this.accessToken)throw new Tt("[Fetch Pay Config] could not fetch pay configs since required accessToken is missing.");l=A(f({},await Bn({configOptionsEndpoint:Le.CV2_CONFIG_REST_API_URL,checkoutUrl:s,sourceId:(e=Bt(i))!=null?e:"",accessToken:this.accessToken,instrument:this.name})),{placement:this.pageType===k.ProductPage?"Product":"Cart"})}delete l.appId,t.initCheckout(f(f({},l),Number(o)!==0&&{estimatedOrderAmount:{amount:o,currencyCode:this.buyerCurrency}})),m.sheetClicked({instrument:this.name,result:"success"})}catch(i){const{name:o}=i!=null?i:{};Le.EXPECTED_ERRORS.includes(o)||g.notify(i),m.sheetClicked({instrument:this.name,result:"failed"});const s=r.translate("brand.amazon_pay");H(r.translate("error_dialogs.wallet.title",{wallet:s}),r.translate("error_dialogs.wallet.generic_error",{wallet:s}))}}async createContainer(){const t=await this.classNames,e=document.createElement("div");return e.id=Le.CONTAINER_ID,e.style.display="flex",e.className=t,e}async render(){var t;try{if(!this.container){this.container=await this.createContainer(),this.appendChild(this.container);const e=window.amazon.Pay.renderButton("#".concat(Le.CONTAINER_ID),A(f({},this.walletParams),{placement:this.pageType===k.ProductPage?"Product":"Cart"}));e==null||e.onClick(()=>this.handleClick(e)),(t=this.onRendered)==null||t.call(this)}}catch(e){g.notify(e)}}};c(z,"CV2_CONFIG_REST_API_URL","".concat(window.location.origin,"/wallets/config/amazon_pay")),c(z,"CONTAINER_ID","PortableWalletsAmazonPayButtonContainer"),c(z,"EXPECTED_ERRORS",[Ae.name,Tt.name]);let le=z;const st=class Me extends G{static walletName(){return"amazon_pay"}constructor(t){super(t)}getWebComponentName(){return"shopify-amazon-pay-button"}getInstrumentName(){return w.AmazonPay}isMockedAmazonServiceUsed(){return!1}getWebComponentClass(){return le}async loadWalletSDK(){if(await Un({sdkUrl:Me.SDK_URL,shouldMock:!1,maxRetries:Me.MAX_RETRIES}),this.isMockedAmazonServiceUsed()){const t=window.amazon.Pay.renderButton;window.amazon.Pay.renderButton=(e,r)=>{const a=t(e,r);return a.initCheckout=Mn.Pay.initCheckout,a}}}};c(st,"MAX_RETRIES",3),c(st,"SDK_URL",me);let ce=st;var Qt={Purple:{D0:"#4524DB",D1:"#30368D",D2:"#1C234C",L0:"#6445ED",L1:"#9C83F8",L2:"#EEEAFF",L3:"#F7F5FF",Primary:"#5433EB",PrimaryLight:"#DBD1FF"},Grayscale:{Black:"#000000",D0:"#666666",D1:"#404040",D2:"#121212",D3:"#0B0B0C",D2D:"#2A2A2A",PrimaryLight:"#707070",L1:"#A8A8A7",L2:"#CBCBCA",L2L:"#E3E3E3",L3:"#F0F0F0",L4:"#F2F4F5",White:"#FFFFFF"},Green:{D1:"#008552",D2:"#004839",L1:"#BAEBCB",L2:"#D2F2DE",L3:"#E4F6EB",Primary:"#92D08D"},Poppy:{D0:"#F05D38",D1:"#D92A0F",D2:"#832711",L1:"#FFD2C2",L2:"#FFECE9",Primary:"#FF967D"},Ochre:{D0:"#F8DB67",D1:"#E3BE2B",D2:"#C29D05",D4:"#443600",L1:"#FFF4CB",L2:"#FFF9E2",Primary:"#FFEC9F"},Brand:{Aqua:"#8DC0C6",Lime:"#C7DE00",Magenta:"#D354FF",Olive:"#8B8F01",Sage:"#D8E59D",Sand:"#F4F4ED",Violet:"#A327C2"}},jo={none:0,xs:4,xs100:6,s:8,s100:10,m:12,l:16,xl:20,xxl:28,max:999999},Vo={0:0,none:0,xxxs:2,xxs:4,xs:8,"xs-s":12,s:16,gutter:20,m:24,l:32,section:36,xl:40,xxl:48,xxxl:64,auto:"auto"},Go=class extends HTMLElement{static get observedAttributes(){return["disabled"]}constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){this._updateButton()}attributeChangedCallback(){this._updateButton()}_updateButton(){var n;let t=this.shadowRoot;t&&(t.innerHTML=Qo,this.hasAttribute("disabled")&&((n=this.shadowRoot.querySelector("button"))==null||n.setAttribute("disabled","")))}};function Yo(){window.customElements&&(customElements.get("gravity-button")||customElements.define("gravity-button",Go))}var Qo="\n<style>\n  * {\n    box-sizing: border-box;\n    border-width: 0;\n    border-style: solid;\n    border-color: currentColor;\n    --focused-box-shadow: 0 0 0 3px #DBD1FF, 0 0 #0000;\n  }\n\n  button {\n    text-transform: none;\n    -webkit-appearance: button;\n    background-color: transparent;\n    background-image: none;\n    font-family: inherit;\n    font-feature-settings: inherit;\n    font-variation-settings: inherit;\n    font-size: 100%;\n    font-weight: inherit;\n    line-height: inherit;\n    letter-spacing: inherit;\n    color: inherit;\n    margin: 0;\n    padding: 0;\n    cursor: pointer;\n  }\n\n  button:disabled {\n    cursor: default;\n    opacity: 0.5;\n  }\n\n  .gravity-button {\n    position: relative;\n    display: flex;\n    height: var(--gravity-button-height);\n    width: var(--gravity-button-width, 260px);\n    justify-content: center;\n    color: ".concat(Qt.Grayscale.White,";\n    align-items: center;\n    overflow: visible;\n    padding: var(--gravity-button-padding, ").concat(Vo.s,"px 10px);\n    border-radius: var(--buttons-radius-outset, var(--gravity-button-border-radius, ").concat(jo.m,"px));\n    border: none;\n    background-color: ").concat(Qt.Purple.Primary,";\n    transition: all;\n  }\n\n  .gravity-button:not([disabled]):focus-visible {\n    box-shadow: var(--focused-base-box-shadow, var(--focused-box-shadow));\n    outline: var(--focused-base-outline, 2px solid transparent);\n    outline-offset: var(--focused-base-outline-offset, 2px);\n  }\n\n  .gravity-button:not([disabled]):hover {\n    background-color: ").concat(Qt.Purple.D0,';\n  }\n</style>\n\n<button class="gravity-button">\n  <slot id="button-content"></slot>\n</button>\n');const Jo=".gravity-button-wrapper{--gravity-button-width: 100%;--gravity-button-height: 100%;--gravity-button-border-radius: var(--wallet-button-border-radius);display:flex}.button-content{display:flex;align-items:center;justify-content:center;width:100%;height:100%;gap:3px;white-space:nowrap}";class Xo extends V{constructor(){super(...arguments),c(this,"name",w.ShopPay),c(this,"fragment",null),c(this,"button",null)}static get observedAttributes(){return["disabled"]}connectedCallback(){this.cleanupOnFailure(async()=>{Yo(),await this.render()},this.name)}attributeChangedCallback(t,e,r){super.attributeChangedCallback(t,e,r,this.button)}disconnectedCallback(){this.button&&this.removeChild(this.button)}createAndAppendStyleFragment(){if(!this.button)return;this.fragment=document.createDocumentFragment();const t=document.createElement("style");t.innerHTML=Jo,this.fragment.append(t,this.button),this.appendChild(this.fragment)}async addButtonContent(){if(!this.button)return;const t=await this.i18n,e=this.hasAttribute("call-to-action"),r=t.translate("buy_with_button_content");let a;const i=new DOMParser().parseFromString(qn.shopPayLogoElement,"image/svg+xml").documentElement;e?a=On({buttonContent:r,logoElement:i,setAriaHidden:!1}):(a=document.createElement("div"),a.appendChild(i)),a.classList.add("button-content"),this.button.appendChild(a)}getShopPayBehavior(){return this.pageType===k.ProductPage?"force_shop_pay_product":this.pageType===k.CartPage?"force_shop_pay_cart":"force_shop_pay"}async handleClick(t){if(t.preventDefault(),this.disabled||!this.button||this.button.getAttribute("disabled"))return;this.disabled=!0;const[e,r]=await Promise.all([this.i18n,this.dataSource]);try{const{outOfStock:a,cart:i}=await nt({element:this,instrumentName:w.MoreOptions,dataSource:r,willHandleErrorCodes(o){return o.length===1&&o[0]===b.InvalidQuantity},walletPreferences:["shop_pay"]});if(m.sheetClicked({instrument:this.name,checkoutToken:Bt(i),result:"success"}),a){Ut(e);return}et(i.checkoutUrl,this.getShopPayBehavior())}catch(a){g.notify(new Zo("An error occurred when attempting to a cart using the Shop Pay Button. Details: ".concat(a))),m.sheetClicked({instrument:this.name,result:"failed"}),H(e.translate("error_dialogs.checkout.title"),e.translate("error_dialogs.checkout.generic_error"))}}async render(){this.button||(this.button=document.createElement("gravity-button")),this.fragment||this.createAndAppendStyleFragment();const t=await this.classNames;await this.addButtonContent(),this.button.className=t,this.button.classList.add("gravity-button-wrapper"),this.disabled&&this.button.setAttribute("disabled","true"),this.button.setAttribute("aria-hidden","true"),this.button.onclick=e=>this.handleClick(e),this.appendChild(this.button)}}class Zo extends Error{constructor(){super(...arguments),c(this,"name","ShopPayButtonError")}}var ti=Object.defineProperty,ei=Object.getOwnPropertyDescriptor,ni=(n,t,e,r)=>{for(var a=r>1?void 0:r?ei(t,e):t,i=n.length-1,o;i>=0;i--)(o=n[i])&&(a=(r?o(t,e,a):o(a))||a);return r&&a&&ti(t,e,a),a},lt;const zn=(lt=class extends G{static walletName(){return"shop_pay"}constructor(n){super(n)}getWebComponentName(){return"shop-pay-wallet-button"}getWebComponentClass(){return Xo}getInstrumentName(){return w.ShopPay}async loadWalletSDK(){await this.loadLogo()}getLoadEligibility(){return{eligible:!0}}async loadLogo(){lt.shopPayLogoElement=(await import("./shop-pay-logo-CYhOC7ye.js")).default}},c(lt,"shopPayLogoElement"),lt);ni([ve("Shop Pay")],zn.prototype,"getLoadEligibility",1);let qn=zn;const ri="shopify-google-pay-button[disabled=true]{opacity:.5;cursor:not-allowed;pointer-events:none}";class ai extends V{constructor(){super(),c(this,"name",w.GooglePay),c(this,"paymentsClient",null),c(this,"container",null),c(this,"measurementContainer",null),c(this,"resizeObserver",null),c(this,"onPaymentDataChanged",t=>{console.log("GooglePayButton::onPaymentDataChanged",t)}),c(this,"onPaymentAuthorized",t=>{console.log("GooglePayButton::onPaymentAuthorized",t)}),c(this,"onClick",()=>{console.log("GooglePayButton::onClick"),!this.disabled&&m.sheetClicked({instrument:this.name,result:"success"})}),this.resizeObserver=typeof ResizeObserver=="function"&&new ResizeObserver(()=>this.onResize())||null}static get observedAttributes(){return["disabled"]}connectedCallback(){this.cleanupOnFailure(this.render.bind(this),this.name)}disconnectedCallback(){this.resizeObserver&&this.resizeObserver.disconnect()}async onResize(){this.container.style.height="".concat(this.getContainerHeight(),"px")}getContainerHeight(){return this.measurementContainer.getBoundingClientRect().height}async createPaymentsClient(){const t={environment:this.walletParams.environment,merchantInfo:{merchantId:this.walletParams.merchantId,merchantName:this.walletParams.merchantName,merchantOrigin:this.walletParams.merchantOrigin,authJwt:this.walletParams.authJwt},paymentDataCallbacks:{onPaymentDataChanged:this.onPaymentDataChanged,onPaymentAuthorized:this.onPaymentAuthorized}};this.paymentsClient=new window.google.payments.api.PaymentsClient(t)}async setupRenderingContainers(){var t;const e=await this.classNames,r=document.createElement("style");this.container=document.createElement("div"),this.measurementContainer=document.createElement("div"),r.innerHTML=ri,this.appendChild(r),this.measurementContainer.className=e,j(this.measurementContainer,{"aria-hidden":"true",tabindex:"-1"}),X(this.measurementContainer,{display:"block",opacity:"0",visibility:"hidden","pointer-events":"none",position:"absolute"}),this.measurementContainer.innerHTML="&nbsp;",this.appendChild(this.measurementContainer),this.container.className=e,j(this.container,{role:"button"}),X(this.container,{overflow:"hidden",height:"".concat(this.getContainerHeight(),"px")}),this.appendChild(this.container),(t=this.resizeObserver)==null||t.observe(this.measurementContainer)}async renderFromGooglePaySDK(){if(!this.container)throw new Error("[".concat(w.GooglePay,"] button container not set when attempting to render"));if(!this.paymentsClient||!this.paymentsClient.createButton)throw new Error("[".concat(w.GooglePay,"] paymentsClient not set when attempting to render"));this.container.innerHTML="";const t=await this.i18n,e=this.paymentsClient.createButton({buttonColor:this.buttonTheme==="DARK"?"black":"white",buttonType:this.hasAttribute("call-to-action")?"buy":"plain",buttonSizeMode:"fill",buttonRadius:0,buttonLocale:t.locale,onClick:this.onClick});this.container.appendChild(e)}async render(){await this.createPaymentsClient(),await this.setupRenderingContainers(),await this.renderFromGooglePaySDK(),this.onRendered()}}const J=class Re extends G{static walletName(){return"google_pay"}constructor(t){super(t)}getWebComponentName(){return"shopify-google-pay-button"}getInstrumentName(){return w.GooglePay}getWebComponentClass(){return ai}async loadWalletSDK(){if(Re.googlePaySDKPromise)return Re.googlePaySDKPromise;const t=document.createElement("script");return t.setAttribute("src",this.walletParams.sdkUrl),Re.googlePaySDKPromise=new Promise((e,r)=>{t.onload=()=>e(),t.onerror=a=>{document.body.removeChild(t),r(a)},document.body.appendChild(t)}),Re.googlePaySDKPromise}getLoadEligibility(){return{eligible:!0}}getPartnerSDKEligibility(){return{eligible:!0}}};c(J,"googlePaySDKPromise");let ue=J;const oi=[Fa,ae,Se,ue,St,ce,qn],ii=new Map(oi.map(n=>[n.walletName(),t=>new n(t)]));function Dt(n){const t=ii.get(n.name);return t?t(n):(console.debug("Can't build wallet with name ".concat(n.name)),null)}function si(n){return n.map(t=>Dt(t)).filter(Boolean)}const Hn="dynamic-checkout .wallet-button-fade-in,cart-wallet-buttons .wallet-button-fade-in{animation:animation-fade-in .3s cubic-bezier(.1,.79,1,1)}dynamic-checkout .shopify-payment-button__button,cart-wallet-buttons .shopify-payment-button__button{cursor:pointer}@keyframes animation-fade-in{0%{opacity:0}to{opacity:1}}button[aria-disabled=true]{opacity:.5;cursor:not-allowed}",li=".shopify-payment-button__button--hidden{visibility:hidden}.shopify-payment-button__button{border-radius:4px;border:none;box-shadow:0 0 0 0 transparent;color:#fff;cursor:pointer;display:block;font-size:1em;font-weight:500;line-height:1;text-align:center;width:100%;min-height:44px;transition:background .2s ease-in-out}.shopify-payment-button__button[disabled]{opacity:.6;cursor:default}.shopify-payment-button__button--unbranded{background-color:#1990c6;padding:1em 2em}.shopify-payment-button__button--unbranded:hover:not([disabled]){background-color:#136f99}.shopify-payment-button__more-options{background:transparent;border:0 none;cursor:pointer;display:block;font-size:1em;margin-top:1em;text-align:center;text-decoration:underline;width:100%}.shopify-payment-button__more-options.shopify-payment-button__skeleton{width:50%;margin-left:25%;margin-right:25%}.shopify-payment-button__more-options[disabled]{opacity:.6;cursor:default}.shopify-payment-button__button.shopify-payment-button__button--branded{display:flex;flex-direction:column;position:relative;z-index:1;--wallet-button-border-radius: 0px}.shopify-payment-button__button.shopify-payment-button__button--branded .shopify-cleanslate{flex:1!important;display:flex!important;flex-direction:column!important}.shopify-payment-button__button.button.loading{position:relative;color:transparent}.shopify-payment-button__button.button.loading>.loading-overlay__spinner{top:50%;left:50%;transform:translate(-50%,-50%);position:absolute;height:100%;display:flex;align-items:center}.shopify-payment-button__button.button.loading>.loading-overlay__spinner .spinner{width:-moz-fit-content;width:-webkit-fit-content;width:fit-content}.button.loading>.loading-overlay__spinner .path{stroke:#fff}.shopify-payment-button__button .loading-overlay__spinner{width:1.8rem;display:inline-block}.shopify-payment-button__button .spinner{animation:shopify-rotator 1.4s linear infinite}@keyframes shopify-rotator{0%{transform:rotate(0)}to{transform:rotate(270deg)}}.shopify-payment-button__button .path{stroke-dasharray:280;stroke-dashoffset:0;transform-origin:center;stroke:#121212;animation:shopify-dash 1.4s ease-in-out infinite}@media screen and (forced-colors: active){.shopify-payment-button__button .path{stroke:CanvasText}}@keyframes shopify-dash{0%{stroke-dashoffset:280}50%{stroke-dashoffset:75;transform:rotate(135deg)}to{stroke-dashoffset:280;transform:rotate(450deg)}}@keyframes walletsLoadingSkeleton{50%{opacity:1}75%{opacity:.5}to{opacity:1}}.shopify-payment-button__skeleton{animation:walletsLoadingSkeleton 4s ease infinite;animation-delay:-.168s;background-color:#dedede;box-sizing:border-box;text-decoration:none!important}";class ci{constructor(t,e,r){this.getElement=t,this.apiClient=e,this.instrumentName=r}async getCart({walletPreferences:t}={}){const e=this.getElement(),r=bn(e);if(!r)throw new Error("[".concat(this.instrumentName,"] unable to find product form"));const a=wt(dr),i=t?{preferences:{wallet:t}}:void 0,{data:o,errors:s}=await this.apiClient.createCart(A(f({},r),{discountCodes:a?[a]:[],buyerIdentity:i}));if(!o)throw new Error("Failed to create cart: No cart returned");return{cart:o,errors:s}}}function Kn({instanceNumber:n,styleId:t,styles:e,cssFileName:r}){var a,i;n===1&&(i=(a=window.Shopify)==null?void 0:a.PaymentButton)!=null&&i.isStorefrontPortableWallets&&(ui({styleId:t,styles:e,cssFileName:r})||di({styleId:t,styles:e}))}function ui({styleId:n,styles:t,cssFileName:e}){return!!document.querySelector("style#".concat(n))}function di({styleId:n,styles:t}){const e=document.createElement("style");e.id=n,e.innerHTML=t,document.head.appendChild(e)}const nn=2e3,Lt=class Si extends we{constructor(){super(),c(this,"instanceNumber",++Si.instanceCount),c(this,"formObserver"),c(this,"dataSource"),c(this,"wrapper"),c(this,"shopPromiseEligible"),this.wrapper=document.createElement("div"),this.formObserver=new Ra(this,({disabled:t,hasSellingPlan:e})=>{this.disabled=t,this.hasSellingPlan=e,this.wrapper&&(this.isShippingRequired=pi(this.wrapper,this.variantParams))}),ye({shop:{shopId:this.shopId}}),Kn({instanceNumber:this.instanceNumber,styleId:"shopify-dynamic-checkout",styles:li,cssFileName:"dynamic-checkout-base.css"}),this.shopPromiseEligible=$r()}static get observedAttributes(){return["access-token","disabled","has-selling-plan","requires-shipping"]}async connectedCallback(){var t,e,r,a;try{if((e=(t=this.wrapper)==null?void 0:t.children)!=null&&e.length)return;if(!this.validateRenderingSurface()){this.clearUI();return}this.instanceNumber===1&&m.initStarted();const i=zt(N.ButtonDisplay,"dc:".concat(this.instanceNumber));this.i18n=$t();const o=()=>this.wrapper,s=await this.loadWallet(),l=(s==null?void 0:s.getInstrumentName())===w.ApplePay||(s==null?void 0:s.getInstrumentName())===w.PayPal||(s==null?void 0:s.getInstrumentName())===w.GooglePay;this.apiClient=new Kt({accessToken:this.accessToken,country:this.buyerCountry,locale:this.i18n.locale,withCarrierRates:l}),this.dataSource=new ci(o,this.apiClient,(r=s==null?void 0:s.getInstrumentName())!=null?r:w.BuyItNow);const u=(a=s==null?void 0:s.getInstrumentName())!=null?a:w.BuyItNow,d=s==null?void 0:s.createWebComponent({walletContainer:this,dataSource:this.dataSource,i18n:this.i18n,apiClient:this.apiClient,classNames:hi(u),callToAction:"true",pageType:k.ProductPage,containerInstanceNumber:this.instanceNumber,onRendered:()=>m.instrumentLoaded({instrument:u,result:"success",measurement:i()})});if(!d)throw new Error("[DynamicCheckout] No web component found");this.render(d,u),this.formObserver.setupMutationObservers(),m.initCompleted({result:"success"}),this.instanceNumber===1&&this.triggerLoadedEvent()}catch(i){if(this.clearUI(),i instanceof Error&&i.name==="DeveloperError"){const o=i;console.error(o),m.initCompleted({result:"failed",eventType:"[".concat(o.name,"]: ").concat(o.code)});return}m.initCompleted({result:"failed"}),g.notify(i)}}async attributeChangedCallback(t,e,r){e!==r&&(fe(this,t,r),t==="has-selling-plan"&&this.toggleBuyerConsent(this.wrapper,this.apiClient,this.i18n))}render(t,e){if(!this.wrapper)throw new Error("[DynamicCheckout] tried to render with no wrapper element");this.clearUI(),this.wrapper=document.createElement("div");const r=document.createElement("style");r.innerHTML=Hn,this.wrapper.className="wallet-button-fade-in",this.wrapper.appendChild(t),this.renderShopPromiseSlot(),this.renderMorePaymentOptionsLink(e);const a=new DocumentFragment;a.appendChild(r),a.appendChild(this.wrapper),this.appendChild(a)}renderMorePaymentOptionsLink(t){var e,r;if(t===w.BuyItNow)return;const a=document.createElement("more-payment-options-link");j(a,{"buyer-country":(e=this.buyerCountry)!=null?e:"","access-token":(r=this.accessToken)!=null?r:"",disabled:String(this.disabled),"recommended-instrument":t}),a.setDataSource(this.dataSource),a.setI18n(this.i18n),a.setClassNames(Jt.MORE_PAYMENT_OPTION_BUTTON),this.wrapper.appendChild(a)}renderShopPromiseSlot(){if(!this.shopPromiseEligible)return;const t=document.createElement("div");t.setAttribute("data-shopify","shop-promise-payment-button-slot"),this.wrapper.appendChild(t)}clearUI(){this.innerHTML=""}validateRenderingSurface(){return Ce(this)!=null}async loadWallet(){const t=xa(this.recommendedWallet,this.fallbackWallet,"DynamicCheckout");return await mi(A(f({},t),{instanceNumber:this.instanceNumber}))}};c(Lt,"instanceCount",0);let de=Lt;function hi(n){return n===w.BuyItNow?Jt.UNBRANDED_BUTTON:Jt.BRANDED_BUTTON}function pi(n,t){var e;const r=bn(n);return!!((e=t.find(a=>a.id===Number(r==null?void 0:r.variantId)))!=null&&e.requiresShipping)}async function mi({recommendedWallet:n,fallbackWallet:t,instanceNumber:e}){const r=n?Dt(n):null,a=Dt(t);if(be(r)){const i=re({walletInstrument:r,instanceNumber:e}),o="timeout",s=await Promise.race([i,new Promise(l=>setTimeout(()=>l(o),nn))]);if(s===o)m.instrumentSDKLoaded({instrument:r.getInstrumentName(),measurement:nn,result:"timeout"});else if(s instanceof G)return s}return a&&re({walletInstrument:a,instanceNumber:e})}$("dynamic-checkout",de),$("more-payment-options-link",wa,{isChildCustomElement:!0});const yi=n=>{const t=new PerformanceObserver(e=>{e.getEntriesByType("resource").some(r=>r.name.includes(ft.CartUpdate)||r.name.includes(ft.CartChange)||r.name.includes(ft.CartAdd)||r.name.includes(ft.CartClear))&&n()});return t.observe({entryTypes:["resource"]}),t},gi=".additional-checkout-buttons,.additional-checkout-buttons--vertical{container-type:inline-size;container-name:acb}.wallet-cart-button-container,.wallet-cart-button{--wallet-button-border-radius: 4px;height:42px;width:150px;max-width:400px;border-radius:var(--wallet-button-border-radius)}.wallet-cart-grid{margin:0;padding:0;display:flex;gap:1rem;justify-content:flex-end;flex-direction:row}.additional-checkout-buttons--vertical .wallet-cart-grid{justify-content:flex-start;flex-direction:column}.additional-checkout-buttons--vertical .wallet-cart-grid .wallet-cart-button-container,.additional-checkout-buttons--vertical .wallet-cart-grid .wallet-cart-button{width:100%}@container acb (width >= 150px) and (width <= 400px){.wallet-cart-grid:has(>.wallet-cart-button-container:nth-of-type(1)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(2))){justify-content:flex-start;flex-direction:column}.wallet-cart-grid:has(>.wallet-cart-button-container:nth-of-type(1)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(2))) .wallet-cart-button-container,.wallet-cart-grid:has(>.wallet-cart-button-container:nth-of-type(1)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(2))) .wallet-cart-button{width:100%}}@container acb (width <= calc(300px + 1rem)){.wallet-cart-grid:has(>.wallet-cart-button-container:nth-of-type(2)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(3))){justify-content:flex-start;flex-direction:column}.wallet-cart-grid:has(>.wallet-cart-button-container:nth-of-type(2)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(3))) .wallet-cart-button-container,.wallet-cart-grid:has(>.wallet-cart-button-container:nth-of-type(2)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(3))) .wallet-cart-button{width:100%}}@container acb (width <= calc(450px + 2rem)){.wallet-cart-grid:has(>.wallet-cart-button-container:nth-of-type(3)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(4))){justify-content:flex-start;flex-direction:column}.wallet-cart-grid:has(>.wallet-cart-button-container:nth-of-type(3)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(4))) .wallet-cart-button-container,.wallet-cart-grid:has(>.wallet-cart-button-container:nth-of-type(3)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(4))) .wallet-cart-button{width:100%}}@container acb (width <= calc(600px + 3rem)){.wallet-cart-grid:has(>.wallet-cart-button-container:nth-of-type(4)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(5))){justify-content:flex-start;flex-direction:column}.wallet-cart-grid:has(>.wallet-cart-button-container:nth-of-type(4)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(5))) .wallet-cart-button-container,.wallet-cart-grid:has(>.wallet-cart-button-container:nth-of-type(4)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(5))) .wallet-cart-button{width:100%}}@container acb (width <= calc(750px + 4rem)){.wallet-cart-grid:has(>.wallet-cart-button-container:nth-of-type(5)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(6))){justify-content:flex-start;flex-direction:column}.wallet-cart-grid:has(>.wallet-cart-button-container:nth-of-type(5)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(6))) .wallet-cart-button-container,.wallet-cart-grid:has(>.wallet-cart-button-container:nth-of-type(5)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(6))) .wallet-cart-button{width:100%}}.wallet-cart-grid:has(>.wallet-cart-button-container:nth-of-type(6)){justify-content:flex-start;flex-direction:column}.wallet-cart-grid:has(>.wallet-cart-button-container:nth-of-type(6)) .wallet-cart-button-container,.wallet-cart-grid:has(>.wallet-cart-button-container:nth-of-type(6)) .wallet-cart-button{width:100%}@media screen and (max-width: 750px){.wallet-cart-grid{justify-content:flex-start;flex-direction:column}.wallet-cart-grid .wallet-cart-button-container,.wallet-cart-grid .wallet-cart-button{max-width:none;width:100%}}@supports (not (container-type: inline-size)) or (not (selector(:has(*)))){.wallet-cart-grid{justify-content:flex-start;flex-direction:column;gap:0px}.wallet-cart-button-container{width:100%;margin-bottom:10px}.wallet-cart-grid .wallet-cart-button{width:100%}}@keyframes walletsLoadingSkeleton{50%{opacity:1}75%{opacity:.5}to{opacity:1}}.wallet-cart-button__skeleton{animation:walletsLoadingSkeleton 4s ease infinite;animation-delay:-.168s;background-color:#dedede;box-sizing:border-box;text-decoration:none!important}";class fi{constructor(t,e){this.cartToken=t,this.apiClient=e}async getCart({walletPreferences:t}={}){const e="gid://shopify/Cart/".concat(this.cartToken),r=t?{wallet:t}:void 0;if(t){const{data:a,errors:i}=await this.apiClient.updateCartBuyerIdentity({cartId:e,preferences:r});if(!a)throw new Error("Failed to update cart buyer identity with cartId ".concat(e));return{cart:a,errors:i}}return{cart:await this.apiClient.fetchCart(e),errors:[]}}}const Ot=class _i extends we{constructor(){super(),c(this,"instanceNumber",++_i.instanceCount),c(this,"cartObserver",null),c(this,"dataSource",null),c(this,"wrapper"),ye({shop:{shopId:this.shopId,cartId:this.cartId}}),Kn({instanceNumber:this.instanceNumber,styleId:"shopify-dynamic-checkout-cart-grid",styles:gi,cssFileName:"cart-wallet-buttons-base.css"}),this.wrapper=document.createElement("div")}static get observedAttributes(){return["access-token","has-selling-plan","requires-shipping"]}createDataSource(t){const e=wt("cart");if(!e)throw new Error("[CartWalletButtons] cart cookie does not exist");const r=$t(),a=new Kt({accessToken:this.accessToken,country:this.buyerCountry,locale:r.locale,withCarrierRates:t}),i=new fi(e,a);this.dataSource=i,this.apiClient=a,this.i18n=r}async createWebComponents({shouldRefetchCartAttributes:t}){if(!this.walletConfigs)throw new Error("[CartWalletButtons] walletConfigs does not exist");const e=_a(this.walletConfigs,"CartWalletButtons");if(!(e instanceof Array))throw new Error("[CartWalletButtons] invalid walletConfigs found");const r=e.some(o=>o.name==="apple_pay"||o.name==="paypal");this.createDataSource(r),t&&await this.updateAttributes();const a=N.ButtonDisplay,i=o=>"".concat(o,":").concat(this.instanceNumber);return(await bi({walletConfigs:e,instanceNumber:this.instanceNumber,startButtonDisplayBenchmark:o=>qt(a,i(o))})).map(o=>{const s=o.getInstrumentName();return o.createWebComponent({walletContainer:this,dataSource:this.dataSource,i18n:this.i18n,apiClient:this.apiClient,classNames:lr,pageType:k.CartPage,containerInstanceNumber:this.instanceNumber,onRendered:()=>m.instrumentLoaded({instrument:s,result:"success",measurement:tt(a,i(s))})})})}async cartChangedCallback(){try{const t=wt("cart");if(!this.dataSource&&t){await this.render({shouldRefetchCartAttributes:!0});return}else if(!t){m.cartTokenMissing({reason:"cartChangedCallback"});return}await this.updateAttributes()}catch(t){this.innerHTML="",g.notify(t)}}async updateAttributes(){const{cart:t}=await this.dataSource.getCart();if(!(t!=null&&t.id))throw new Error("[".concat(this.updateAttributes,"] received invalid cart"));this.hasSellingPlan=t.lineItems.some(e=>e.sellingPlanAllocation!=null),this.isShippingRequired=t.lineItems.some(e=>e.merchandise.requiresShipping)}async connectedCallback(){try{if(R({event:T.CartInitCalled}),this.cartObserver=yi(()=>this.cartChangedCallback()),!wt("cart")){m.cartTokenMissing({reason:"connectedCallback"});return}await this.render({shouldRefetchCartAttributes:!1})}catch(t){this.innerHTML="",g.notify(t)}}disconnectedCallback(){var t;(t=this.cartObserver)==null||t.disconnect()}async attributeChangedCallback(t,e,r){e!==r&&(fe(this,t,r),t==="has-selling-plan"&&this.toggleBuyerConsent(this.wrapper,this.apiClient,this.i18n))}async render({shouldRefetchCartAttributes:t}){const e=zt(N.ButtonDisplay,"cart:".concat(this.instanceNumber)),r=await this.createWebComponents({shouldRefetchCartAttributes:t});if(this.innerHTML="",r.length===0)return;const a=document.createElement("style");a.innerHTML=Hn,this.wrapper=document.createElement("div"),this.wrapper.className="wallet-button-fade-in";const i=document.createElement("div");i.className="wallet-cart-grid",i.setAttribute("data-shopify-buttoncontainer","true"),r.forEach(s=>{const l=document.createElement("div");l.className="wallet-cart-button-container",l.appendChild(s),i.appendChild(l)}),this.wrapper.appendChild(i),this.toggleBuyerConsent(this.wrapper,this.apiClient,this.i18n);const o=new DocumentFragment;o.appendChild(a),o.appendChild(this.wrapper),this.appendChild(o),R({event:T.InstrumentLoaded,instrumentId:"CartWalletButtons",ttl:e()})}};c(Ot,"instanceCount",0);let he=Ot;async function bi({walletConfigs:n,instanceNumber:t,startButtonDisplayBenchmark:e=()=>{}}){const r=Ia(si(n));return(await Promise.all(r.map(a=>(e(a.getInstrumentName()),re({walletInstrument:a,instanceNumber:t}))))).filter(a=>a)}$("cart-wallet-buttons",he);class wi{getCart(){throw new Error('[NoOpDataSource] Unexpected call to "getCart"')}}const Ft=class Ei extends we{constructor(){super(),c(this,"instanceNumber",++Ei.instanceCount),ye({shop:{shopId:this.shopId}})}get walletConfig(){return this.getAttribute("wallet-config")}async connectedCallback(){try{if(this.children.length)return;this.instanceNumber===1&&m.initStarted();const t=zt(N.ButtonDisplay,"dc:".concat(this.instanceNumber)),e=Pa(this.walletConfig,"WalletButton");if(!e)throw new Ea("[WalletButton] No config provided.");const r=Dt(e);if(!r||!await this.eligibleToShow(r))return;const a=r.getInstrumentName();this.i18n=$t(),this.apiClient=new Kt({accessToken:this.accessToken,country:this.buyerCountry,locale:this.i18n.locale});const i=this.createWebComponent(r,this.i18n,this.apiClient,a,t);this.innerHTML="",this.appendChild(i),m.initCompleted({result:"success"}),this.instanceNumber===1&&this.triggerLoadedEvent()}catch(t){this.innerHTML="",m.initCompleted({result:"failed"}),g.notify(t)}}createWebComponent(t,e,r,a,i){const o=t.createWebComponent({walletContainer:this,dataSource:new wi,i18n:e,apiClient:r,containerInstanceNumber:this.instanceNumber});return o.onRendered=()=>{m.instrumentLoaded({instrument:a,result:"success",measurement:i()})},o}async eligibleToShow(t){return!(!be(t)||(await t.loadWalletSDK(),!t.getPartnerSDKEligibility().eligible))}};c(Ft,"instanceCount",0);let pe=Ft;$("shopify-wallet-button",pe),ir(g),sr(g),m.startExporter();
